import{f as o}from"./form.90751a24.js";import{E as i}from"./EditorWrapper.2386c422.js";import{I as l}from"./ImageUploader.e0a7dbc8.js";import{E as r}from"./event-bus.6a5776a8.js";import{K as m}from"./vendor/vendor-k-progress.b67acade.js";import{n}from"./_plugin-vue2_normalizer.7b9a2fe2.js";const u={extends:o,components:{EditorWrapper:i,ImageUploader:l,KProgress:m},data(){return{formData:{uuid:null,title:"",body:"",slug:"",status:!1,template:null,parent:null,media:null,meta:{seoTitle:"",keywords:"",description:"",showFooter:!1}},preRequisite:{templates:[],parents:[]},initUrl:"site/pages",seoRecommendedMinChars:180,seoRecommendedMaxChars:220,progressBarColors:["#f5365c","#fb6340","#ffd600","#5e72e4","#2dce89"]}},computed:{imageUploadURL(){return`site/pages/${this.formData.uuid}/media`},seoTitleProgressStatus(){let s=this.getProgress(this.formData.meta.seoTitle,50);return s<50?"error":s<99?"success":"warning"},seoDescProgressStatus(){let s=this.getProgress(this.formData.meta.description,145,5);return s<50?"error":s<99?"success":"warning"},formStatus(){return this.formData.uuid?this.editData&&!this.duplicate?"editing":"saved":"creating"},seoTitle:{get(){return this.formData.meta.seoTitle||this.formData.title},set(s){this.formData.meta.seoTitle=s}},seoDescription:{get(){return this.formData.meta.description?this.formData.meta.description:this.getExcerpt(this.formData.body)},set(s){this.formData.meta.description=s}},seoUrl(){return this.getLocation()+"/.../"+this.formData.slug}},methods:{getProgress(s,t,e=1){let a=parseInt((s.length/(t+e)*100).toFixed(0));return a>100?100:a},publish(){this.formData.status=!0,this.submit()},draft(){this.formData.status=!1,this.submit()},createSlug(){this.showKeepAdding&&this.formData.title!=this.initialFormData.title?this.formData.slug=this.formData.title.kebabCase():this.formData.slug=this.formData.slug?this.formData.slug:this.formData.title.kebabCase()},getLocation(){return document.location.origin},uploadedImage(){this.formStatus==="editing"?this.getEntityData():this.$router.back()},uploadedImageError(){this.formStatus==="saved"?this.$router.back():r.$emit("CANCEL_UPLOAD")},noNeedCallback(){this.formStatus==="saved"?this.$router.back():this.getEntityData()},afterEditData(){this.duplicate&&(this.formData.uuid=null,this.formData.status=!1,this.formData.media=null)},afterSubmit(s){this.formData.uuid||(this.formData.uuid=s.page.uuid),this.initialFormData=_.cloneDeep(this.formData),this.formData.uuid&&this.$nextTick(()=>{r.$emit("START_UPLOAD")})},getExcerpt(s){return formUtil.getExcerpt(formUtil.stripHtml(s),300)}},mounted(){this.getInitialData()}};var d=function(){var t=this,e=t._self._c;return e("form",{on:{submit:function(a){return a.preventDefault(),t.doNothing.apply(null,arguments)}}},[e("animated-loader",{attrs:{"is-loading":t.isLoading||t.isFetching,"loader-color":t.vars.loaderColor}}),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-md-9"},[e("base-container",{attrs:{boxed:""}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 mb-3"},[e("base-input",{attrs:{"auto-focus":"",label:t.$t("site.page.props.title"),type:"text",error:t.formErrors.title,required:""},on:{"update:error":function(a){return t.$set(t.formErrors,"title",a)},blur:t.createSlug},model:{value:t.formData.title,callback:function(a){t.$set(t.formData,"title",a)},expression:"formData.title"}})],1),e("div",{staticClass:"col-12 mt-4 mb-3"},[e("editor-wrapper",{attrs:{label:t.$t("site.page.props.body"),error:t.formErrors.body,required:""},on:{"update:error":function(a){return t.$set(t.formErrors,"body",a)}},model:{value:t.formData.body,callback:function(a){t.$set(t.formData,"body",a)},expression:"formData.body"}})],1),e("div",{staticClass:"col-12 mb-3"},[e("base-input",{attrs:{label:t.$t("site.page.props.slug"),type:"text",error:t.formErrors.slug,format:"kebabCase",required:""},on:{"update:error":function(a){return t.$set(t.formErrors,"slug",a)},blur:t.createSlug,focus:t.createSlug},model:{value:t.formData.slug,callback:function(a){t.$set(t.formData,"slug",a)},expression:"formData.slug"}}),t.formData.slug?e("div",{staticClass:"small text-muted"},[t._v(t._s(t.getLocation()+"/.../"+t.formData.slug))]):t._e()],1)]),e("fieldset",{staticClass:"fieldset primary mt-5"},[e("legend",[t._v(t._s(t.$t("site.seo")))]),t.seoTitle?e("div",{staticClass:"search-preview-wrapper mb-4"},[e("h6",{staticClass:"text-muted mb-3"},[t._v(t._s(t.$t("site.google_preview")))]),e("div",{staticClass:"title"},[t._v(t._s(t._f("charLimit")(t.seoTitle,50)))]),e("div",{staticClass:"url"},[t._v(t._s(t._f("charLimit")(t.seoUrl,70)))]),e("div",{staticClass:"description"},[t._v(t._s(t._f("charLimit")(t.seoDescription,145)))])]):t._e(),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 mb-3"},[e("base-input",{attrs:{label:t.$t("site.page.props.seo_title"),type:"text",error:t.formErrors.seoTitle},on:{"update:error":function(a){return t.$set(t.formErrors,"seoTitle",a)}},model:{value:t.formData.meta.seoTitle,callback:function(a){t.$set(t.formData.meta,"seoTitle",a)},expression:"formData.meta.seoTitle"}}),t.formData.meta.seoTitle?e("k-progress",{attrs:{"show-text":!1,percent:t.getProgress(t.formData.meta.seoTitle,50),status:t.seoTitleProgressStatus}}):t._e()],1),e("div",{staticClass:"col-12 mb-3"},[e("base-textarea",{attrs:{rows:"2",label:t.$t("site.page.props.description"),error:t.formErrors.description,"char-count":""},on:{"update:error":function(a){return t.$set(t.formErrors,"description",a)}},model:{value:t.formData.meta.description,callback:function(a){t.$set(t.formData.meta,"description",a)},expression:"formData.meta.description"}}),t.formData.meta.description?e("k-progress",{attrs:{"show-text":!1,percent:t.getProgress(t.formData.meta.description,145,5),status:t.seoDescProgressStatus}}):t._e()],1),e("div",{staticClass:"col-12"},[e("base-textarea",{attrs:{rows:"2",label:t.$t("site.page.props.keywords"),error:t.formErrors.keywords},on:{"update:error":function(a){return t.$set(t.formErrors,"keywords",a)}},model:{value:t.formData.meta.keywords,callback:function(a){t.$set(t.formData.meta,"keywords",a)},expression:"formData.meta.keywords"}})],1)])])])],1),e("div",{staticClass:"col-12 col-md-3 d-flex flex-column"},[e("card",{staticClass:"mb-4"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("view-single",{attrs:{"data-classes":"small",label:t.$t("site.page.page")+" "+t.$t("site.page.props.status"),value:t.formData.status?t.$t("site.published"):t.$t("site.draft")}})],1),t.editData&&!t.duplicate?[e("div",{staticClass:"col-12"},[e("view-date",{attrs:{"data-classes":"small",label:t.$t("general.created_at"),value:t.formData.createdAt,"to-format":t.vars.defaultDateTimeFormat}})],1),e("div",{staticClass:"col-12"},[e("view-date",{attrs:{"data-classes":"small",label:t.$t("general.updated_at"),value:t.formData.updatedAt,"to-format":t.vars.defaultDateTimeFormat}})],1)]:t._e()],2),t.formHasErrors?e("div",{staticClass:"alert alert-danger my-3",attrs:{role:"alert"}},[e("h6",{staticClass:"m-0"},[t._v(t._s(t.$t("general.form_has_errors")))])]):t._e(),e("div",{staticClass:"form-footer mt-3"},[t.formData.status?e("div",{key:"published",staticClass:"both-side"},[e("base-button",{staticClass:"text-center",attrs:{type:"button",design:"link",tabindex:"-1"},on:{click:t.draft}},[t._v(t._s(t.$t("site.unpublish")))]),e("base-button",{attrs:{type:"button",design:"primary"},on:{click:t.publish}},[t._v(t._s(t.$t("general.update")))])],1):e("div",{key:"draft",staticClass:"both-side"},[e("base-button",{attrs:{type:"button",design:"light"},on:{click:t.draft}},[t.formData.uuid?[t._v(t._s(t.$t("general.update")))]:[t._v(t._s(t.$t("general.save")))]],2),e("base-button",{attrs:{type:"button",design:"primary"},on:{click:t.publish}},[t._v(t._s(t.$t("general.publish")))])],1)])]),e("card",{staticClass:"mb-4",attrs:{title:t.$t("site.featured_image")}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 d-flex justify-content-center"},[e("image-uploader",{attrs:{url:t.imageUploadURL,"existing-image":t.formData.media?t.formData.media.url:null,"existing-media":t.formData.media,"show-upload-button":!t.showKeepAdding},on:{uploaded:t.uploadedImage,error:t.uploadedImageError,noNeed:t.noNeedCallback,removed:t.getEntityData}})],1)])]),e("card",{staticClass:"mb-4",attrs:{title:t.$t("site.attributes")}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 mb-3"},[e("base-select",{attrs:{options:t.preRequisite.templates,label:t.$t("site.page_template.template"),error:t.formErrors.template,required:"","preselect-first":""},on:{"update:error":function(a){return t.$set(t.formErrors,"template",a)}},model:{value:t.formData.template,callback:function(a){t.$set(t.formData,"template",a)},expression:"formData.template"}})],1),e("div",{staticClass:"col-12 mb-3"},[e("base-select",{attrs:{options:t.preRequisite.pages,label:t.$t("site.page.props.parent"),error:t.formErrors.parent,"allow-empty":!0},on:{"update:error":function(a){return t.$set(t.formErrors,"parent",a)}},model:{value:t.formData.parent,callback:function(a){t.$set(t.formData,"parent",a)},expression:"formData.parent"}})],1)])]),e("card",{staticClass:"flex-grow",attrs:{title:t.$t("site.options")}},[e("div",{staticClass:"row"})])],1)])],1)},c=[],f=n(u,d,c,!1,null,null,null,null);const C=f.exports;export{C};
