var He=function(U,z){var ae="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";(function(e){!e||typeof window<"u"||typeof global>"u"||(global.navigator={userAgent:ae,getUserMedia:function(){}},global.console||(global.console={}),typeof global.console.debug>"u"&&(global.console.debug=global.console.info=global.console.error=global.console.log=global.console.log||function(){console.log(arguments)}),typeof document>"u"&&(e.document={},document.createElement=document.captureStream=document.mozCaptureStream=function(){var d={getContext:function(){return d},play:function(){},pause:function(){},drawImage:function(){},toDataURL:function(){return""}};return d},document.addEventListener=document.removeEventListener=e.addEventListener=e.removeEventListener=function(){},e.HTMLVideoElement=e.HTMLMediaElement=function(){}),typeof io>"u"&&(e.io=function(){return{on:function(d,u){u=u||function(){},d==="connect"&&u()},emit:function(d,u,v){v=v||function(){},(d==="open-room"||d==="join-room")&&v(!0,u.sessionid,null)}}}),typeof location>"u"&&(e.location={protocol:"file:",href:"",hash:"",origin:"self"}),typeof screen>"u"&&(e.screen={width:0,height:0}),typeof URL>"u"&&(e.URL={createObjectURL:function(){return""},revokeObjectURL:function(){return""}}),e.window=global)})(typeof global<"u"?global:null);function G(e,d){function u(a){return!a.audio&&!a.video&&!a.screen&&a.data}var v="";v+="?userid="+e.userid,v+="&sessionid="+e.sessionid,v+="&msgEvent="+e.socketMessageEvent,v+="&socketCustomEvent="+e.socketCustomEvent,v+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,e.session.broadcast===!0&&(v+="&oneToMany=true"),v+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(v+="&enableScalableBroadcast=true",v+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),v+="&extra="+JSON.stringify(e.extra||{}),e.socketCustomParameters&&(v+=e.socketCustomParameters);try{io.sockets={}}catch{}if(e.socketURL||(e.socketURL="/"),e.socketURL.substr(e.socketURL.length-1,1)!="/")throw'"socketURL" MUST end with a slash.';e.enableLogs&&(e.socketURL=="/"?console.info("socket.io url is: ",location.origin+"/"):console.info("socket.io url is: ",e.socketURL));try{e.socket=io(e.socketURL+v)}catch{e.socket=io.connect(e.socketURL+v,e.socketOptions)}var n=e.multiPeersHandler;e.socket.on("extra-data-updated",function(a,h){!e.peers[a]||(e.peers[a].extra=h,e.onExtraDataUpdated({userid:a,extra:h}),o(a,h))});function o(a,h){e.peersBackup[a]||(e.peersBackup[a]={userid:a,extra:{}}),e.peersBackup[a].extra=h}function f(a){if(a.remoteUserId==e.userid){if(e.peers[a.sender]&&e.peers[a.sender].extra!=a.message.extra&&(e.peers[a.sender].extra=a.extra,e.onExtraDataUpdated({userid:a.sender,extra:a.extra}),o(a.sender,a.extra)),a.message.streamSyncNeeded&&e.peers[a.sender]){var h=e.streamEvents[a.message.streamid];if(!h||!h.stream)return;var y=a.message.action;if(y==="ended"||y==="inactive"||y==="stream-removed"){e.peersBackup[h.userid]&&(h.extra=e.peersBackup[h.userid].extra),e.onstreamended(h);return}var O=a.message.type!="both"?a.message.type:null;typeof h.stream[y]=="function"&&h.stream[y](O);return}if(a.message==="dropPeerConnection"){e.deletePeer(a.sender);return}if(a.message.allParticipants){a.message.allParticipants.indexOf(a.sender)===-1&&a.message.allParticipants.push(a.sender),a.message.allParticipants.forEach(function(r){n[e.peers[r]?"renegotiatePeer":"createNewPeer"](r,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||e.direction==="one-way",isDataOnly:u(e.session)})});return}if(a.message.newParticipant){if(a.message.newParticipant==e.userid||e.peers[a.message.newParticipant])return;n.createNewPeer(a.message.newParticipant,a.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||e.direction==="one-way",isDataOnly:u(e.session)});return}if(a.message.readyForOffer&&(e.attachStreams.length&&(e.waitingForLocalMedia=!1),e.waitingForLocalMedia)){setTimeout(function(){f(a)},1);return}if(a.message.newParticipationRequest&&a.sender!==e.userid){e.peers[a.sender]&&e.deletePeer(a.sender);var A={extra:a.extra||{},localPeerSdpConstraints:a.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:a.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:typeof a.message.isOneWay<"u"?a.message.isOneWay:!!e.session.oneway||e.direction==="one-way",isDataOnly:typeof a.message.isDataOnly<"u"?a.message.isDataOnly:u(e.session),dontGetRemoteStream:typeof a.message.isOneWay<"u"?a.message.isOneWay:!!e.session.oneway||e.direction==="one-way",dontAttachLocalStream:!!a.message.dontGetRemoteStream,connectionDescription:a,successCallback:function(){}};e.onNewParticipant(a.sender,A);return}if(a.message.changedUUID&&e.peers[a.message.oldUUID]&&(e.peers[a.message.newUUID]=e.peers[a.message.oldUUID],delete e.peers[a.message.oldUUID]),a.message.userLeft){n.onUserLeft(a.sender),a.message.autoCloseEntireSession&&e.leave();return}n.addNegotiatedMessage(a.message,a.sender)}}e.socket.on(e.socketMessageEvent,f);var p=!1;e.socket.resetProps=function(){p=!1},e.socket.on("connect",function(){p||(p=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){e.socket.emit("extra-data-updated",e.extra)},1e3),d&&d(e.socket))}),e.socket.on("disconnect",function(a){e.onSocketDisconnect(a)}),e.socket.on("error",function(a){e.onSocketError(a)}),e.socket.on("user-disconnected",function(a){a!==e.userid&&(e.onUserStatusChanged({userid:a,status:"offline",extra:e.peers[a]?e.peers[a].extra||{}:{}}),e.deletePeer(a))}),e.socket.on("user-connected",function(a){a!==e.userid&&e.onUserStatusChanged({userid:a,status:"online",extra:e.peers[a]?e.peers[a].extra||{}:{}})}),e.socket.on("closed-entire-session",function(a,h){e.leave(),e.onEntireSessionClosed({sessionid:a,userid:a,extra:h})}),e.socket.on("userid-already-taken",function(a,h){e.onUserIdAlreadyTaken(a,h)}),e.socket.on("logs",function(a){!e.enableLogs||console.debug("server-logs",a)}),e.socket.on("number-of-broadcast-viewers-updated",function(a){e.onNumberOfBroadcastViewersUpdated(a)}),e.socket.on("set-isInitiator-true",function(a){a==e.sessionid&&(e.isInitiator=!0)})}function re(e){var d=this,u=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];e.peers={getLength:function(){var o=0;for(var f in this)u.indexOf(f)==-1&&o++;return o},selectFirst:function(){var o;for(var f in this)u.indexOf(f)==-1&&(o=this[f]);return o},getAllParticipants:function(o){var f=[];for(var p in this)u.indexOf(p)==-1&&p!=o&&f.push(p);return f},forEach:function(o){this.getAllParticipants().forEach(function(f){o(e.peers[f])})},send:function(o,f){var p=this;if(!q(o.size)&&!q(o.type)){if(e.enableFileSharing){d.shareFile(o,f);return}typeof o!="string"&&(o=JSON.stringify(o))}if(o.type!=="text"&&!(o instanceof ArrayBuffer)&&!(o instanceof DataView)){Je.send({text:o,channel:this,connection:e,remoteUserId:f});return}if(o.type==="text"&&(o=JSON.stringify(o)),f){var a=e.peers[f];if(a){if(!a.channels.length){e.peers[f].createDataChannel(),e.renegotiate(f),setTimeout(function(){p.send(o,f)},3e3);return}a.channels.forEach(function(h){h.send(o)});return}}this.getAllParticipants().forEach(function(h){if(!p[h].channels.length){e.peers[h].createDataChannel(),e.renegotiate(h),setTimeout(function(){p[h].channels.forEach(function(y){y.send(o)})},3e3);return}p[h].channels.forEach(function(y){y.send(o)})})}},this.uuid=e.userid,this.getLocalConfig=function(o,f,p){return p||(p={}),{streamsToShare:p.streamsToShare||{},rtcMultiConnection:e,connectionDescription:p.connectionDescription,userid:f,localPeerSdpConstraints:p.localPeerSdpConstraints,remotePeerSdpConstraints:p.remotePeerSdpConstraints,dontGetRemoteStream:!!p.dontGetRemoteStream,dontAttachLocalStream:!!p.dontAttachLocalStream,renegotiatingPeer:!!p.renegotiatingPeer,peerRef:p.peerRef,channels:p.channels||[],onLocalSdp:function(a){d.onNegotiationNeeded(a,f)},onLocalCandidate:function(a){a=je.processCandidates(e,a),a&&d.onNegotiationNeeded(a,f)},remoteSdp:o,onDataChannelMessage:function(a){if(!e.fbr&&e.enableFileSharing&&v(),typeof a=="string"||!e.enableFileSharing){d.onDataChannelMessage(a,f);return}var h=this;if(a instanceof ArrayBuffer||a instanceof DataView){e.fbr.convertToObject(a,function(y){h.onDataChannelMessage(y)});return}if(a.readyForNextChunk){e.fbr.getNextChunk(a,function(y,O){e.peers[f].channels.forEach(function(A){A.send(y)})},f);return}if(a.chunkMissing){e.fbr.chunkMissing(a);return}e.fbr.addChunk(a,function(y){e.peers[f].peer.channel.send(y)})},onDataChannelError:function(a){d.onDataChannelError(a,f)},onDataChannelOpened:function(a){d.onDataChannelOpened(a,f)},onDataChannelClosed:function(a){d.onDataChannelClosed(a,f)},onRemoteStream:function(a){e.peers[f]&&e.peers[f].streams.push(a),d.onGettingRemoteMedia(a,f)},onRemoteStreamRemoved:function(a){d.onRemovingRemoteMedia(a,f)},onPeerStateChanged:function(a){d.onPeerStateChanged(a),a.iceConnectionState==="new"&&d.onNegotiationStarted(f,a),a.iceConnectionState==="connected"&&d.onNegotiationCompleted(f,a),a.iceConnectionState.search(/closed|failed/gi)!==-1&&(d.onUserLeft(f),d.disconnectWith(f))}}},this.createNewPeer=function(o,f){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(f=f||{},e.isInitiator&&!!e.session.audio&&e.session.audio==="two-way"&&!f.streamsToShare&&(f.isOneWay=!1,f.isDataOnly=!1,f.session=e.session),!f.isOneWay&&!f.isDataOnly){f.isOneWay=!0,this.onNegotiationNeeded({enableMedia:!0,userPreferences:f},o);return}f=e.setUserPreferences(f,o);var p=this.getLocalConfig(null,o,f);e.peers[o]=new Re(p)}},this.createAnsweringPeer=function(o,f,p){p=e.setUserPreferences(p||{},f);var a=this.getLocalConfig(o,f,p);e.peers[f]=new Re(a)},this.renegotiatePeer=function(o,f,p){if(!e.peers[o]){e.enableLogs&&console.error("Peer ("+o+") does not exist. Renegotiation skipped.");return}f||(f={}),f.renegotiatingPeer=!0,f.peerRef=e.peers[o].peer,f.channels=e.peers[o].channels;var a=this.getLocalConfig(p,o,f);e.peers[o]=new Re(a)},this.replaceTrack=function(o,f,p,a){if(!e.peers[f])throw"This peer ("+f+") does not exist.";var h=e.peers[f].peer;if(!!h.getSenders&&typeof h.getSenders=="function"&&h.getSenders().length){let A=function(r){var t="lastAudioTrack";p&&r.track.kind==="video"&&(t="lastVideoTrack"),e.peers[f].peer[t]=r.track,r.replaceTrack(o)};var y=null,O=h.getSenders().filter(function(r){return r.track});a&&(y=O.find(function(r){return r.track.id===a.id})),y?A(y):O.forEach(A);return}console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(f)},this.onNegotiationNeeded=function(o,f){},this.addNegotiatedMessage=function(o,f){if(o.type&&o.sdp){o.type=="answer"&&e.peers[f]&&e.peers[f].addRemoteSdp(o),o.type=="offer"&&(o.renegotiatingPeer?this.renegotiatePeer(f,null,o):this.createAnsweringPeer(o,f)),e.enableLogs&&console.log("Remote peer's sdp:",o.sdp);return}if(o.candidate){e.peers[f]&&e.peers[f].addRemoteCandidate(o),e.enableLogs&&console.log("Remote peer's candidate pairs:",o.candidate);return}if(o.enableMedia){e.session=o.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),o.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var p={};e.attachStreams.forEach(function(a){p[a.streamid]={isAudio:!!a.isAudio,isVideo:!!a.isVideo,isScreen:!!a.isScreen}}),o.userPreferences.streamsToShare=p,d.onNegotiationNeeded({readyForOffer:!0,userPreferences:o.userPreferences},f)}o.readyForOffer&&e.onReadyForOffer(f,o.userPreferences)},this.onGettingRemoteMedia=function(o,f){},this.onRemovingRemoteMedia=function(o,f){},this.onGettingLocalMedia=function(o){},this.onLocalMediaError=function(o,f){e.onMediaError(o,f)};function v(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(o){e.onFileProgress(o)},e.fbr.onBegin=function(o){e.onFileStart(o)},e.fbr.onEnd=function(o){e.onFileEnd(o)}}this.shareFile=function(o,f){v(),e.fbr.readAsArrayBuffer(o,function(p){var a=e.getAllParticipants();f&&(a=[f]),a.forEach(function(h){e.fbr.getNextChunk(p,function(y){e.peers[h].channels.forEach(function(O){O.send(y)})},h)})},{userid:e.userid,chunkSize:DetectRTC.browser.name==="Firefox"?15e3:e.chunkSize||0})};var n=new Xe(e);this.onDataChannelMessage=function(o,f){n.receive(JSON.parse(o),f,e.peers[f]?e.peers[f].extra:{})},this.onDataChannelClosed=function(o,f){o.userid=f,o.extra=e.peers[f]?e.peers[f].extra:{},e.onclose(o)},this.onDataChannelError=function(o,f){o.userid=f,event.extra=e.peers[f]?e.peers[f].extra:{},e.onerror(o)},this.onDataChannelOpened=function(o,f){if(e.peers[f].channels.length){e.peers[f].channels=[o];return}e.peers[f].channels.push(o),e.onopen({userid:f,extra:e.peers[f]?e.peers[f].extra:{},channel:o})},this.onPeerStateChanged=function(o){e.onPeerStateChanged(o)},this.onNegotiationStarted=function(o,f){},this.onNegotiationCompleted=function(o,f){},this.getRemoteStreams=function(o){return o=o||e.peers.getAllParticipants()[0],e.peers[o]?e.peers[o].streams:[]}}(function(){var e="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45",M=typeof process=="object"&&typeof process.versions=="object"&&process.versions.node&&!process.browser;if(M){var d=process.versions.node.toString().replace("v","");e="Nodejs/"+d+" (NodeOS) AppleWebKit/"+d+" (KHTML, like Gecko) Nodejs/"+d+" Nodejs/"+d}(function(g){typeof window<"u"||(typeof window>"u"&&typeof global<"u"&&(global.navigator={userAgent:e,getUserMedia:function(){}},g.window=global),typeof location>"u"&&(g.location={protocol:"file:",href:"",hash:""}),typeof screen>"u"&&(g.screen={width:0,height:0}))})(typeof global<"u"?global:window);var u=window.navigator;typeof u<"u"?(typeof u.webkitGetUserMedia<"u"&&(u.getUserMedia=u.webkitGetUserMedia),typeof u.mozGetUserMedia<"u"&&(u.getUserMedia=u.mozGetUserMedia)):u={getUserMedia:function(){},userAgent:e};var v=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(u.userAgent||""),n=u.userAgent.indexOf("Edge")!==-1&&(!!u.msSaveOrOpenBlob||!!u.msSaveBlob),o=!!window.opera||u.userAgent.indexOf(" OPR/")>=0,f=typeof window.InstallTrigger<"u",p=/^((?!chrome|android).)*safari/i.test(u.userAgent),a=!!window.chrome&&!o,h=typeof document<"u"&&!!document.documentMode&&!n;function y(){u.appVersion;var g=u.userAgent,c=u.appName,b=""+parseFloat(u.appVersion),k=parseInt(u.appVersion,10),S,E,ee;if(p&&!a&&g.indexOf("CriOS")!==-1&&(p=!1,a=!0),o){c="Opera";try{b=u.userAgent.split("OPR/")[1].split(" ")[0],k=b.split(".")[0]}catch{b="0.0.0.0",k=0}}else h?(E=g.indexOf("rv:"),E>0?b=g.substring(E+3):(E=g.indexOf("MSIE"),b=g.substring(E+5)),c="IE"):a?(E=g.indexOf("Chrome"),c="Chrome",b=g.substring(E+7)):p?(E=g.indexOf("Safari"),c="Safari",b=g.substring(E+7),(E=g.indexOf("Version"))!==-1&&(b=g.substring(E+8)),u.userAgent.indexOf("Version/")!==-1&&(b=u.userAgent.split("Version/")[1].split(" ")[0])):f?(E=g.indexOf("Firefox"),c="Firefox",b=g.substring(E+8)):(S=g.lastIndexOf(" ")+1)<(E=g.lastIndexOf("/"))&&(c=g.substring(S,E),b=g.substring(E+1),c.toLowerCase()===c.toUpperCase()&&(c=u.appName));return n&&(c="Edge",b=u.userAgent.split("Edge/")[1]),(ee=b.search(/[; \)]/))!==-1&&(b=b.substring(0,ee)),k=parseInt(""+b,10),isNaN(k)&&(b=""+parseFloat(u.appVersion),k=parseInt(u.appVersion,10)),{fullVersion:b,version:k,name:c,isPrivateBrowsing:!1}}function O(g,c){var b=0,k=50,S=!1,E=window.setInterval(function(){g()&&(window.clearInterval(E),c(S)),b++>k&&(window.clearInterval(E),S=!0,c(S))},10)}function A(g){var c=g.toLowerCase();if(c.indexOf("msie")===0&&c.indexOf("trident")===0)return!1;var b=/(?:msie|rv:)\s?([\d\.]+)/.exec(c);return!!(b&&parseInt(b[1],10)>=10)}function r(g){var c;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){c=!1},function(k){c=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var b;try{b=window.indexedDB.open("test"),b.onerror=function(){return!0}}catch{c=!0}typeof c>"u"&&O(function(){return b.readyState==="done"},function(S){S||(c=!b.result)})}else if(A(window.navigator.userAgent)){c=!1;try{window.indexedDB||(c=!0)}catch{c=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch{c=!0}typeof c>"u"&&(c=!1,window.localStorage.removeItem("test"))}}catch{c=!1}O(function(){return typeof c<"u"},function(S){g(c)})}var t={Android:function(){return u.userAgent.match(/Android/i)},BlackBerry:function(){return u.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return u.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return u.userAgent.match(/Opera Mini/i)},Windows:function(){return u.userAgent.match(/IEMobile/i)},any:function(){return t.Android()||t.BlackBerry()||t.iOS()||t.Opera()||t.Windows()},getOsName:function(){var g="Unknown OS";return t.Android()&&(g="Android"),t.BlackBerry()&&(g="BlackBerry"),t.iOS()&&(g="iOS"),t.Opera()&&(g="Opera Mini"),t.Windows()&&(g="Windows"),g}};function i(){for(var g="-",c=u.appVersion,b=u.userAgent,k=g,S=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],E=0,ee;ee=S[E];E++)if(ee.r.test(b)){k=ee.s;break}var X=g;switch(/Windows/.test(k)&&(/Windows (.*)/.test(k)&&(X=/Windows (.*)/.exec(k)[1]),k="Windows"),k){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(b)&&(X=/Mac OS X (10[\.\_\d]+)/.exec(b)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(b)&&(X=/Android ([\.\_\d]+)/.exec(b)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(b)&&(X=/OS (\d+)_(\d+)_?(\d+)?/.exec(c),X=X[1]+"."+X[2]+"."+(X[3]|0));break}return{osName:k,osVersion:X}}var s="Unknown OS",l="Unknown OS Version";function w(g){g=(g||u.userAgent).toLowerCase();var c=g.match(/android\s([0-9\.]*)/);return c?c[1]:!1}var P=i();P&&P.osName&&P.osName!="-"?(s=P.osName,l=P.osVersion):t.any()&&(s=t.getOsName(),s=="Android"&&(l=w()));var M=typeof process=="object"&&typeof process.versions=="object"&&process.versions.node;s==="Unknown OS"&&M&&(s="Nodejs",l=process.versions.node.toString().replace("v",""));var F=!1,se=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(g){typeof document>"u"||typeof document.createElement!="function"||(!F&&g in document.createElement("canvas")&&(F=!0),!se&&g in document.createElement("video")&&(se=!0))});var de=/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/,ye=/([0-9]{1,3}(\.[0-9]{1,3}){3})/,Ke=/[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7}/;function Ye(g,c){if(!!m.isWebRTCSupported){var b=!0,k=!0;$e(function(S){S?S.match(de)?(b=!1,g("Local: "+S,b,k)):(S.match(Ke)&&(k=!1),g("Public: "+S,b,k)):g()},c)}}function $e(g,c){if(typeof document>"u"||typeof document.getElementById!="function")return;var b={},k=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!k){var S=document.getElementById("iframe");if(!S)return;var E=S.contentWindow;k=E.RTCPeerConnection||E.mozRTCPeerConnection||E.webkitRTCPeerConnection}if(!k)return;var ee=null;m.browser==="Chrome"&&m.browser.version<58&&(ee={optional:[{RtpDataChannels:!0}]});var X={iceServers:[{urls:"stun:stun.l.google.com:19302"}]},J=new k(X,ee);c&&(J.addStream?J.addStream(c):J.addTrack&&c.getTracks()[0]&&J.addTrack(c.getTracks()[0],c));function Pe(H){if(!H){g();return}var fe=ye.exec(H);if(!!fe){var De=fe[1],tr=H.match(de),ar=!0;b[De]===void 0&&g(De,tr,ar),b[De]=!0}}if(J.onicecandidate=function(H){H.candidate&&H.candidate.candidate?Pe(H.candidate.candidate):Pe()},!c)try{J.createDataChannel("sctp",{})}catch{}m.isPromisesSupported?J.createOffer().then(function(H){J.setLocalDescription(H).then(Ue)}):J.createOffer(function(H){J.setLocalDescription(H,Ue,function(){})},function(){});function Ue(){var H=J.localDescription.sdp.split(`
`);H.forEach(function(fe){fe&&fe.indexOf("a=candidate:")===0&&Pe(fe)})}}var me=[],oe=[],ne=[],ue=[];u.mediaDevices&&u.mediaDevices.enumerateDevices&&(u.enumerateDevices=function(g){var c=u.mediaDevices.enumerateDevices();c&&c.then?u.mediaDevices.enumerateDevices().then(g).catch(function(){g([])}):g([])});var Me=!1;(typeof Q<"u"&&"getSources"in Q||u.mediaDevices&&!!u.mediaDevices.enumerateDevices)&&(Me=!0);var ce=!1,be=!1,ke=!1,ve=!1,ge=!1;function Qe(g){if(!Me){g&&g();return}if(!u.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(u.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!u.enumerateDevices&&u.enumerateDevices&&(u.enumerateDevices=u.enumerateDevices.bind(u)),!u.enumerateDevices){g&&g();return}me=[],oe=[],ne=[],ue=[],ce=!1,be=!1,ke=!1,ve=!1,ge=!1;var c={};u.enumerateDevices(function(b){b.forEach(function(k){var S={};for(var E in k)try{typeof k[E]!="function"&&(S[E]=k[E])}catch{}c[S.deviceId+S.label+S.kind]||(S.kind==="audio"&&(S.kind="audioinput"),S.kind==="video"&&(S.kind="videoinput"),S.deviceId||(S.deviceId=S.id),S.id||(S.id=S.deviceId),S.label?(S.kind==="videoinput"&&!ge&&(ge=!0),S.kind==="audioinput"&&!ve&&(ve=!0)):(S.isCustomLabel=!0,S.kind==="videoinput"?S.label="Camera "+(ue.length+1):S.kind==="audioinput"?S.label="Microphone "+(oe.length+1):S.kind==="audiooutput"?S.label="Speaker "+(ne.length+1):S.label="Please invoke getUserMedia once.",typeof m<"u"&&m.browser.isChrome&&m.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&typeof document<"u"&&typeof document.domain=="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1&&(S.label="HTTPs is required to get label of this "+S.kind+" device.")),S.kind==="audioinput"&&(ce=!0,oe.indexOf(S)===-1&&oe.push(S)),S.kind==="audiooutput"&&(be=!0,ne.indexOf(S)===-1&&ne.push(S)),S.kind==="videoinput"&&(ke=!0,ue.indexOf(S)===-1&&ue.push(S)),me.push(S),c[S.deviceId+S.label+S.kind]=S)}),typeof m<"u"&&(m.MediaDevices=me,m.hasMicrophone=ce,m.hasSpeakers=be,m.hasWebcam=ke,m.isWebsiteHasWebcamPermissions=ge,m.isWebsiteHasMicrophonePermissions=ve,m.audioInputDevices=oe,m.audioOutputDevices=ne,m.videoInputDevices=ue),g&&g()})}var m=window.DetectRTC||{};m.browser=y(),r(function(g){m.browser.isPrivateBrowsing=!!g}),m.browser["is"+m.browser.name]=!0,m.osName=s,m.osVersion=l,typeof process=="object"&&typeof process.versions=="object"&&process.versions["node-webkit"];var Ee=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(g){Ee||g in window&&(Ee=!0)}),m.isWebRTCSupported=Ee,m.isORTCSupported=typeof RTCIceGatherer<"u";var te=!1;if((m.browser.isChrome&&m.browser.version>=35||m.browser.isFirefox&&m.browser.version>=34||m.browser.isEdge&&m.browser.version>=17||m.osName==="Android"&&m.browser.isChrome)&&(te=!0),!/^(https:|chrome-extension:)$/g.test(location.protocol||"")){var Ze=typeof document<"u"&&typeof document.domain=="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1;(Ze&&(m.browser.isChrome||m.browser.isEdge||m.browser.isOpera)||m.browser.isFirefox)&&(te=!1)}m.isScreenCapturingSupported=te;var he={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(g){he.isSupported||g in window&&(he.isSupported=!0,window[g]&&"createMediaStreamSource"in window[g].prototype&&(he.isCreateMediaStreamSourceSupported=!0))}),m.isAudioContextSupported=he.isSupported,m.isCreateMediaStreamSourceSupported=he.isCreateMediaStreamSourceSupported;var We=!1;m.browser.isChrome&&m.browser.version>31&&(We=!0),m.isRtpDataChannelsSupported=We;var Te=!1;(m.browser.isFirefox&&m.browser.version>28||m.browser.isChrome&&m.browser.version>25||m.browser.isOpera&&m.browser.version>=11)&&(Te=!0),m.isSctpDataChannelsSupported=Te,m.isMobileDevice=v;var Se=!1;(u.getUserMedia||u.mediaDevices&&u.mediaDevices.getUserMedia)&&(Se=!0),m.browser.isChrome&&m.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&typeof document<"u"&&typeof document.domain=="string"&&document.domain.search&&document.domain.search(/localhost|127.0./g)===-1&&(Se="Requires HTTPs"),m.osName==="Nodejs"&&(Se=!1),m.isGetUserMediaSupported=Se;var Ve="";if(screen.width){var er=screen.width?screen.width:"",rr=screen.height?screen.height:"";Ve+=""+er+" x "+rr}m.displayResolution=Ve;function ir(g,c){function b(S,E){return E==0?S:b(E,S%E)}var k=b(g,c);return g/k/(c/k)}m.displayAspectRatio=ir(screen.width,screen.height).toFixed(2),m.isCanvasSupportsStreamCapturing=F,m.isVideoSupportsStreamCapturing=se,m.browser.name=="Chrome"&&m.browser.version>=53&&(m.isCanvasSupportsStreamCapturing||(m.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),m.isVideoSupportsStreamCapturing||(m.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),m.DetectLocalIPAddress=Ye,m.isWebSocketsSupported="WebSocket"in window&&window.WebSocket.CLOSING===2,m.isWebSocketsBlocked=!m.isWebSocketsSupported,m.osName==="Nodejs"&&(m.isWebSocketsSupported=!0,m.isWebSocketsBlocked=!1),m.checkWebSocketsSupport=function(g){g=g||function(){};try{var c,b=new WebSocket("wss://echo.websocket.org:443/");b.onopen=function(){m.isWebSocketsBlocked=!1,c=new Date().getTime(),b.send("ping")},b.onmessage=function(){m.WebsocketLatency=new Date().getTime()-c+"ms",g(),b.close(),b=null},b.onerror=function(){m.isWebSocketsBlocked=!0,g()}}catch{m.isWebSocketsBlocked=!0,g()}},m.load=function(g){g=g||function(){},Qe(g)},typeof me<"u"?m.MediaDevices=me:m.MediaDevices=[],m.hasMicrophone=ce,m.hasSpeakers=be,m.hasWebcam=ke,m.isWebsiteHasWebcamPermissions=ge,m.isWebsiteHasMicrophonePermissions=ve,m.audioInputDevices=oe,m.audioOutputDevices=ne,m.videoInputDevices=ue;var Be=!1;typeof document<"u"&&typeof document.createElement=="function"&&"setSinkId"in document.createElement("video")&&(Be=!0),m.isSetSinkIdSupported=Be;var Oe=!1;m.browser.isFirefox&&typeof mozRTCPeerConnection<"u"?"getSenders"in mozRTCPeerConnection.prototype&&(Oe=!0):m.browser.isChrome&&typeof webkitRTCPeerConnection<"u"&&"getSenders"in webkitRTCPeerConnection.prototype&&(Oe=!0),m.isRTPSenderReplaceTracksSupported=Oe;var qe=!1;m.browser.isFirefox&&m.browser.version>38&&(qe=!0),m.isRemoteStreamProcessingSupported=qe;var Ie=!1;typeof Q<"u"&&"applyConstraints"in Q.prototype&&(Ie=!0),m.isApplyConstraintsSupported=Ie;var Fe=!1;m.browser.isFirefox&&m.browser.version>=43&&(Fe=!0),m.isMultiMonitorScreenCapturingSupported=Fe,m.isPromisesSupported="Promise"in window,m.version="1.3.9",typeof m>"u"&&(window.DetectRTC={});var we=window.MediaStream;typeof we>"u"&&typeof webkitMediaStream<"u"&&(we=webkitMediaStream),typeof we<"u"&&typeof we=="function"?m.MediaStream=Object.keys(we.prototype):m.MediaStream=!1,typeof Q<"u"?m.MediaStreamTrack=Object.keys(Q.prototype):m.MediaStreamTrack=!1;var Ge=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;typeof Ge<"u"?m.RTCPeerConnection=Object.keys(Ge.prototype):m.RTCPeerConnection=!1,window.DetectRTC=m,typeof module<"u"&&(module.exports=m),typeof define=="function"&&define.amd&&define("DetectRTC",[],function(){return m})})(),typeof cordova<"u"&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&navigator.userAgent.indexOf("Crosswalk")!==-1&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome");function B(e,d,u){if(!(typeof CustomEvent>"u")){var v={arguments:u,__exposedProps__:u},n=new CustomEvent(d,v);e.dispatchEvent(n)}}function T(e,d){if(!(!d.stream||!W(d.stream,"audio").length)){if(!e||!d)throw"Both arguments are required.";if(!(!e.onspeaking||!e.onsilence)){if(typeof hark>"u")throw"hark.js not found.";hark(d.stream,{onspeaking:function(){e.onspeaking(d)},onsilence:function(){e.onsilence(d)},onvolumechange:function(u,v){!e.onvolumechange||e.onvolumechange(merge({volume:u,threshold:v},d))}})}}}function D(e,d){!d.stream||!d.stream||!d.stream.addEventListener||(d.stream.addEventListener("mute",function(u){u=e.streamEvents[d.streamid],u.session={audio:u.muteType==="audio",video:u.muteType==="video"},e.onmute(u)},!1),d.stream.addEventListener("unmute",function(u){u=e.streamEvents[d.streamid],u.session={audio:u.unmuteType==="audio",video:u.unmuteType==="video"},e.onunmute(u)},!1))}function x(){if(window.crypto&&window.crypto.getRandomValues&&navigator.userAgent.indexOf("Safari")===-1){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),d="",u=0,v=e.length;u<v;u++)d+=e[u].toString(36);return d}else return(Math.random()*new Date().getTime()).toString(36).replace(/\./g,"")}function C(e,d,u){if(!u.autoCreateMediaElement){d({});return}var v=!1;!W(e,"video").length&&!e.isVideo&&!e.isScreen&&(v=!0),DetectRTC.browser.name==="Firefox"&&(u.session.video||u.session.screen)&&(v=!1);var n=document.createElement(v?"audio":"video");if(n.srcObject=e,n.setAttribute("autoplay",!0),n.setAttribute("playsinline",!0),n.setAttribute("controls",!0),n.setAttribute("muted",!1),n.setAttribute("volume",1),DetectRTC.browser.name==="Firefox"){var o="ended";"oninactive"in n&&(o="inactive"),n.addEventListener(o,function(){if(currentUserMediaRequest.remove(e.idInstance),e.type==="local"){o="ended","oninactive"in e&&(o="inactive"),_.onSyncNeeded(e.streamid,o),u.attachStreams.forEach(function(y,O){e.streamid===y.streamid&&delete u.attachStreams[O]});var a=[];u.attachStreams.forEach(function(y){y&&a.push(y)}),u.attachStreams=a;var h=u.streamEvents[e.streamid];if(h){u.onstreamended(h);return}this.parentNode&&this.parentNode.removeChild(this)}},!1)}var f=n.play();if(typeof f<"u"){var p=!1;setTimeout(function(){p||(p=!0,d(n))},1e3),f.then(function(){p||(p=!0,d(n))}).catch(function(a){p||(p=!0,d(n))})}else d(n)}window.addEventListener||(window.addEventListener=function(e,d,u){!e.attachEvent||e.attachEvent("on"+d,u)});function R(e,d){window.removeEventListener(e,d),window.addEventListener(e,d,!1)}window.attachEventListener=function(e,d,u,v){e.addEventListener(d,u,v)};function N(e){var d=[];return e.forEach(function(u){u&&d.push(u)}),d}function L(e){return!e.audio&&!e.video&&!e.screen&&e.data}function q(e){return typeof e>"u"}function le(e){return typeof e=="string"}var K=window.MediaStream;typeof K>"u"&&typeof webkitMediaStream<"u"&&(K=webkitMediaStream),typeof K<"u"&&("stop"in K.prototype||(K.prototype.stop=function(){this.getTracks().forEach(function(e){e.stop()})}));function V(e,d){return e.session.audio&&e.session.audio==="two-way"?!1:DetectRTC.browser.name==="Firefox"&&d!==!1?!0:DetectRTC.browser.name!=="Chrome"||DetectRTC.browser.version<50?!1:typeof d===!0?!0:typeof d>"u"&&e.session.audio&&e.session.screen&&!e.session.video?(d=!0,!0):!1}window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker";function W(e,d){return!e||!e.getTracks?[]:e.getTracks().filter(function(u){return u.kind===(d||"audio")})}function Ce(){var e=!1;try{if(typeof RTCRtpTransceiver>"u"||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;var d=new I;try{d.addTransceiver("audio"),e=!0}catch{}d.close()}catch{e=!1}return e&&Y()}function Y(){var e=!1;try{var d=new I({sdpSemantics:"unified-plan"});try{var u=d.getConfiguration();u.sdpSemantics=="unified-plan"?e=!0:(u.sdpSemantics=="plan-b",e=!1)}catch{e=!1}}catch{e=!1}return e}function pe(){if(!(typeof cordova>"u"||typeof cordova.plugins>"u"||typeof cordova.plugins.iosrtc>"u")){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),typeof e.selectAudioOutput=="function"&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}document.addEventListener("deviceready",pe,!1),pe();var ie={};function j(e){var d={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo};return d}var I;typeof window.RTCPeerConnection<"u"?I=window.RTCPeerConnection:typeof mozRTCPeerConnection<"u"?I=mozRTCPeerConnection:typeof webkitRTCPeerConnection<"u"&&(I=webkitRTCPeerConnection);var $=window.RTCSessionDescription||window.mozRTCSessionDescription,Ae=window.RTCIceCandidate||window.mozRTCIceCandidate,Q=window.MediaStreamTrack;function Re(e){if(typeof window.RTCPeerConnection<"u"?I=window.RTCPeerConnection:typeof mozRTCPeerConnection<"u"?I=mozRTCPeerConnection:typeof webkitRTCPeerConnection<"u"&&(I=webkitRTCPeerConnection),$=window.RTCSessionDescription||window.mozRTCSessionDescription,Ae=window.RTCIceCandidate||window.mozRTCIceCandidate,Q=window.MediaStreamTrack,!I)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var d=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:d.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(i){d.addStream(i,u.userid)},this.removeStream=function(i){d.removeStream(i,u.userid)};var u=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var v={};ie.sdpConstraints=j({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var n,o=!!e.renegotiatingPeer;e.remoteSdp&&(o=!!e.remoteSdp.renegotiatingPeer);var f=[];if(d.attachStreams.forEach(function(i){i&&f.push(i)}),o)n=e.peerRef;else{var p="all";(d.candidates.turn||d.candidates.relay)&&!d.candidates.stun&&!d.candidates.reflexive&&!d.candidates.host&&(p="relay");try{var a={iceServers:d.iceServers,iceTransportPolicy:d.iceTransportPolicy||p};typeof d.iceCandidatePoolSize<"u"&&(a.iceCandidatePoolSize=d.iceCandidatePoolSize),typeof d.bundlePolicy<"u"&&(a.bundlePolicy=d.bundlePolicy),typeof d.rtcpMuxPolicy<"u"&&(a.rtcpMuxPolicy=d.rtcpMuxPolicy),d.sdpSemantics&&(a.sdpSemantics=d.sdpSemantics||"unified-plan"),(!d.iceServers||!d.iceServers.length)&&(a=null,d.optionalArgument=null),n=new I(a,d.optionalArgument)}catch{try{var a={iceServers:d.iceServers};n=new I(a)}catch{n=new I}}}!n.getRemoteStreams&&n.getReceivers&&(n.getRemoteStreams=function(){var i=new K;return n.getReceivers().forEach(function(s){i.addTrack(s.track)}),[i]}),!n.getLocalStreams&&n.getSenders&&(n.getLocalStreams=function(){var i=new K;return n.getSenders().forEach(function(s){i.addTrack(s.track)}),[i]}),n.onicecandidate=function(i){if(!i.candidate){if(!d.trickleIce){var s=n.localDescription;e.onLocalSdp({type:s.type,sdp:s.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:u.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:d?d.extra:{},streamsToShare:r})}return}!d.trickleIce||e.onLocalCandidate({candidate:i.candidate.candidate,sdpMid:i.candidate.sdpMid,sdpMLineIndex:i.candidate.sdpMLineIndex})},f.forEach(function(i){e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream||e.dontAttachLocalStream||(i=d.beforeAddingStream(i,u),i&&(n.getLocalStreams().forEach(function(s){i&&s.id==i.id&&(i=null)}),i&&i.getTracks&&i.getTracks().forEach(function(s){try{n.addTrack(s,i)}catch{}})))}),n.oniceconnectionstatechange=n.onsignalingstatechange=function(){var i=u.extra;d.peers[u.userid]&&(i=d.peers[u.userid].extra||i),n&&(e.onPeerStateChanged({iceConnectionState:n.iceConnectionState,iceGatheringState:n.iceGatheringState,signalingState:n.signalingState,extra:i,userid:u.userid}),n&&n.iceConnectionState&&n.iceConnectionState.search(/closed|failed/gi)!==-1&&u.streams instanceof Array&&u.streams.forEach(function(s){var l=d.streamEvents[s.id]||{streamid:s.id,stream:s,type:"remote"};d.onstreamended(l)}))};var h={OfferToReceiveAudio:!!f.length,OfferToReceiveVideo:!!f.length};e.localPeerSdpConstraints&&(h=e.localPeerSdpConstraints),ie.sdpConstraints=j(h);var y={};n.ontrack=function(i){if(!(!i||i.type!=="track")){if(i.stream=i.streams[i.streams.length-1],i.stream.id||(i.stream.id=i.track.id),y[i.stream.id]&&DetectRTC.browser.name!=="Safari"){i.track&&(i.track.onended=function(){n&&n.onremovestream(i)});return}y[i.stream.id]=i.stream.id;var s={};e.remoteSdp&&e.remoteSdp.streamsToShare?s=e.remoteSdp.streamsToShare:e.streamsToShare&&(s=e.streamsToShare);var l=s[i.stream.id];l?(i.stream.isAudio=l.isAudio,i.stream.isVideo=l.isVideo,i.stream.isScreen=l.isScreen):(i.stream.isVideo=!!W(i.stream,"video").length,i.stream.isAudio=!i.stream.isVideo,i.stream.isScreen=!1),i.stream.streamid=i.stream.id,v[i.stream.id]=i.stream,e.onRemoteStream(i.stream),i.stream.getTracks().forEach(function(w){w.onended=function(){n&&n.onremovestream(i)}}),i.stream.onremovetrack=function(){n&&n.onremovestream(i)}}},n.onremovestream=function(i){i.stream.streamid=i.stream.id,v[i.stream.id]&&delete v[i.stream.id],e.onRemoteStreamRemoved(i.stream)},typeof n.removeStream!="function"&&(n.removeStream=function(i){i.getTracks().forEach(function(s){n.removeTrack(s,i)})}),this.addRemoteCandidate=function(i){n.addIceCandidate(new Ae(i))},this.addRemoteSdp=function(i,s){s=s||function(){},DetectRTC.browser.name!=="Safari"&&(i.sdp=d.processSdp(i.sdp)),n.setRemoteDescription(new $(i)).then(s,function(l){d.enableLogs&&console.error("setRemoteDescription failed",`
`,l,`
`,i.sdp),s()}).catch(function(l){d.enableLogs&&console.error("setRemoteDescription failed",`
`,l,`
`,i.sdp),s()})};var O=!0;e.remoteSdp&&(O=!1),this.createDataChannel=function(){var i=n.createDataChannel("sctp",{});A(i)},d.session.data===!0&&!o&&(O?this.createDataChannel():n.ondatachannel=function(i){var s=i.channel;A(s)}),this.enableDisableVideoEncoding=function(i){var s;if(n.getSenders().forEach(function(w){!s&&w.track.kind==="video"&&(s=w)}),!(!s||!s.getParameters)){var l=s.getParameters();l.encodings[1]&&(l.encodings[1].active=!!i),l.encodings[2]&&(l.encodings[2].active=!!i),s.setParameters(l)}},e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(h=e.remoteSdp.remotePeerSdpConstraints),ie.sdpConstraints=j(h),this.addRemoteSdp(e.remoteSdp,function(){t("createAnswer")}));function A(i){i.binaryType="arraybuffer",i.onmessage=function(s){e.onDataChannelMessage(s.data)},i.onopen=function(){e.onDataChannelOpened(i)},i.onerror=function(s){e.onDataChannelError(s)},i.onclose=function(s){e.onDataChannelClosed(s)},i.internalSend=i.send,i.send=function(s){i.readyState==="open"&&i.internalSend(s)},n.channel=i}(d.session.audio=="two-way"||d.session.video=="two-way"||d.session.screen=="two-way")&&(ie.sdpConstraints=j({OfferToReceiveAudio:d.session.audio=="two-way"||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:d.session.video=="two-way"||d.session.screen=="two-way"||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var r={};n.getLocalStreams().forEach(function(i){r[i.streamid]={isAudio:!!i.isAudio,isVideo:!!i.isVideo,isScreen:!!i.isScreen}});function t(i){!n||!n[i]||n[i](ie.sdpConstraints).then(function(s){DetectRTC.browser.name!=="Safari"&&(s.sdp=d.processSdp(s.sdp)),n&&n.setLocalDescription(s).then(function(){!d.trickleIce||(e.onLocalSdp({type:s.type,sdp:s.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:u.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:d?d.extra:{},streamsToShare:r}),d.onSettingLocalDescription(u))},function(l){!d.enableLogs||console.error("setLocalDescription error",l)})},function(s){d.enableLogs&&console.error("sdp-error",s)})}O&&t("createOffer"),n.nativeClose=n.close,n.close=function(){if(!!n){try{n.nativeClose!==n.close&&n.nativeClose()}catch{}n=null,u.peer=null}},this.peer=n}var Z=function(){function e(t,i){var s=u(t);return!s.videoCodecNumbers||i==="vp8"&&s.vp8LineNumber===s.videoCodecNumbers[0]||i==="vp9"&&s.vp9LineNumber===s.videoCodecNumbers[0]||i==="h264"&&s.h264LineNumber===s.videoCodecNumbers[0]||(t=d(t,i,s)),t}function d(t,i,s,l){var w="";if(i==="vp8"){if(!s.vp8LineNumber)return t;w=s.vp8LineNumber}if(i==="vp9"){if(!s.vp9LineNumber)return t;w=s.vp9LineNumber}if(i==="h264"){if(!s.h264LineNumber)return t;w=s.h264LineNumber}var P=s.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",M=[w];return l&&(M=[]),s.videoCodecNumbers.forEach(function(F){F!==w&&M.push(F)}),P+=M.join(" "),t=t.replace(s.videoCodecNumbersOriginal,P),t}function u(t){var i={};return t.split(`
`).forEach(function(s){s.indexOf("m=video")===0&&(i.videoCodecNumbers=[],s.split("SAVPF")[1].split(" ").forEach(function(l){l=l.trim(),!(!l||!l.length)&&(i.videoCodecNumbers.push(l),i.videoCodecNumbersOriginal=s)})),s.indexOf("VP8/90000")!==-1&&!i.vp8LineNumber&&(i.vp8LineNumber=s.replace("a=rtpmap:","").split(" ")[0]),s.indexOf("VP9/90000")!==-1&&!i.vp9LineNumber&&(i.vp9LineNumber=s.replace("a=rtpmap:","").split(" ")[0]),s.indexOf("H264/90000")!==-1&&!i.h264LineNumber&&(i.h264LineNumber=s.replace("a=rtpmap:","").split(" ")[0])}),i}function v(t){var i=u(t);return t=d(t,"vp9",i,!0),t=d(t,"vp8",i,!0),t}function n(t){if(!t||typeof t!="string")throw"Invalid arguments.";return t=t.replace(`a=rtcp-fb:126 nack\r
`,""),t=t.replace(`a=rtcp-fb:126 nack pli\r
`,`a=rtcp-fb:126 pli\r
`),t=t.replace(`a=rtcp-fb:97 nack\r
`,""),t=t.replace(`a=rtcp-fb:97 nack pli\r
`,`a=rtcp-fb:97 pli\r
`),t}function o(t,i){if(!(!i||!i.getSenders||!i.getSenders().length)){if(!t||typeof t!="string")throw"Invalid arguments.";i.getSenders().forEach(function(s){for(var l=s.getParameters(),w=0;w<l.codecs.length;w++)if(l.codecs[w].mimeType==t){l.codecs.unshift(l.codecs.splice(w,1));break}s.setParameters(l)})}}function f(t){return t.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")}function p(t,i,s){return!i||typeof isFirefox<"u"&&isFirefox||(s&&(i.screen?i.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),i.screen&&s&&(t=t.replace(/b=AS([^\r\n]+\r\n)/g,""),t=t.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:`+i.screen+`\r
`)),(i.audio||i.video)&&(t=t.replace(/b=AS([^\r\n]+\r\n)/g,"")),i.audio&&(t=t.replace(/a=mid:audio\r\n/g,`a=mid:audio\r
b=AS:`+i.audio+`\r
`)),i.screen?t=t.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:`+i.screen+`\r
`):i.video&&(t=t.replace(/a=mid:video\r\n/g,`a=mid:video\r
b=AS:`+i.video+`\r
`))),t}function a(t,i,s){return h(t,0,-1,i,s)}function h(t,i,s,l,w){for(var P=s!==-1?s:t.length,M=i;M<P;++M)if(t[M].indexOf(l)===0&&(!w||t[M].toLowerCase().indexOf(w.toLowerCase())!==-1))return M;return null}function y(t){var i=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),s=t.match(i);return s&&s.length===2?s[1]:null}function O(t,i){i=i||{};var s=i.min,l=i.max,w=t.split(`\r
`),P=a(w,"a=rtpmap","VP8/90000"),M;if(P&&(M=y(w[P])),!M)return t;var F=a(w,"a=rtpmap","rtx/90000"),se;if(F&&(se=y(w[F])),!F)return t;var de=a(w,"a=fmtp:"+se.toString());if(de!==null){var ye=`\r
`;ye+="a=fmtp:"+M+" x-google-min-bitrate="+(s||"228")+"; x-google-max-bitrate="+(l||"228"),w[de]=w[de].concat(ye),t=w.join(`\r
`)}return t}function A(t,i){i=i||{};var s=t.split(`\r
`),l=a(s,"a=rtpmap","opus/48000"),w;if(l&&(w=y(s[l])),!w)return t;var P=a(s,"a=fmtp:"+w.toString());if(P===null)return t;var M="";return M+="; stereo="+(typeof i.stereo<"u"?i.stereo:"1"),M+="; sprop-stereo="+(typeof i["sprop-stereo"]<"u"?i["sprop-stereo"]:"1"),typeof i.maxaveragebitrate<"u"&&(M+="; maxaveragebitrate="+(i.maxaveragebitrate||128*1024*8)),typeof i.maxplaybackrate<"u"&&(M+="; maxplaybackrate="+(i.maxplaybackrate||128*1024*8)),typeof i.cbr<"u"&&(M+="; cbr="+(typeof i.cbr<"u"?i.cbr:"1")),typeof i.useinbandfec<"u"&&(M+="; useinbandfec="+i.useinbandfec),typeof i.usedtx<"u"&&(M+="; usedtx="+i.usedtx),typeof i.maxptime<"u"&&(M+=`\r
a=maxptime:`+i.maxptime),s[P]=s[P].concat(M),t=s.join(`\r
`),t}function r(t){for(var i=t.split(`\r
`),s=null,l=0;l<i.length;l++)if(i[l].search("opus/48000")!==-1){var w=extractSdp(i[l],/:(\d+) opus\/48000/i);break}for(var l=0;l<i.length;l++)if(i[l].search("a=fmtp")!==-1){var P=extractSdp(i[l],/a=fmtp:(\d+)/);if(P===w){s=l;break}}return s===null||(i[s]=i[s].concat("; stereo=1; sprop-stereo=1"),t=i.join(`\r
`)),t}return{removeVPX:v,disableNACK:n,prioritize:o,removeNonG722:f,setApplicationSpecificBandwidth:function(t,i,s){return p(t,i,s)},setVideoBitrates:function(t,i){return O(t,i)},setOpusAttributes:function(t,i){return A(t,i)},preferVP9:function(t){return e(t,"vp9")},preferCodec:e,forceStereoAudio:r}}();window.BandwidthHandler=Z;var je=function(){function e(d,u){var v=u.candidate,n=d.candidates,o=n.stun,f=n.turn;if(q(n.reflexive)||(o=n.reflexive),q(n.relay)||(f=n.relay),!(!n.host&&!!v.match(/typ host/g))&&!(!f&&!!v.match(/typ relay/g))&&!(!o&&!!v.match(/typ srflx/g))){var p=d.iceProtocols;if(!(!p.udp&&!!v.match(/ udp /g))&&!(!p.tcp&&!!v.match(/ tcp /g)))return d.enableLogs&&console.debug("Your candidate pairs:",v),{candidate:v,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex}}}return{processCandidates:e}}(),ze=function(){function e(d){var u=[{urls:["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302","stun:stun.l.google.com:19302?transport=udp"]}];return u}return{getIceServers:e}}();function _e(e,d){e.mandatory&&e.mandatory.chromeMediaSource||e.mozMediaSource||e.mediaSource?d.isScreen=!0:e.video?d.isVideo=!0:e.audio&&(d.isAudio=!0)}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var d=this.streams[e];if(!!d){d=d.stream;var u=d.currentUserMediaRequestOptions;this.queueRequests.indexOf(u)&&(delete this.queueRequests[this.queueRequests.indexOf(u)],this.queueRequests=N(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};function xe(e){if(currentUserMediaRequest.mutex===!0){currentUserMediaRequest.queueRequests.push(e);return}currentUserMediaRequest.mutex=!0;var d=JSON.stringify(e.localMediaConstraints);function u(p,a){_e(e.localMediaConstraints,p);var h="ended";"oninactive"in p&&(h="inactive"),p.addEventListener(h,function(){delete currentUserMediaRequest.streams[d],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=N(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[d]={stream:p},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&xe(currentUserMediaRequest.queueRequests.shift()),e.onGettingLocalMedia(p,a)}if(currentUserMediaRequest.streams[d])u(currentUserMediaRequest.streams[d].stream,!0);else{var v=!!/BB10|BlackBerry/i.test(navigator.userAgent||"");if(v||typeof navigator.mediaDevices>"u"||typeof navigator.mediaDevices.getUserMedia!="function"){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia(e.localMediaConstraints,function(p){p.streamid=p.streamid||p.id||x(),p.idInstance=d,u(p)},function(p){e.onLocalMediaError(p,e.localMediaConstraints)});return}if(typeof navigator.mediaDevices>"u"){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var n=function(){},o,f;navigator.mediaDevices={getUserMedia:function(p){return navigator.getUserMedia(p,function(a){a(stream),o=stream},function(a){n(a),f=a}),{then:function(a){if(o){a(o);return}return{then:function(h){if(f){h(f);return}n=h}}}}}}}if(e.localMediaConstraints.isScreen===!0){if(navigator.mediaDevices.getDisplayMedia)navigator.mediaDevices.getDisplayMedia(e.localMediaConstraints).then(function(p){p.streamid=p.streamid||p.id||x(),p.idInstance=d,u(p)}).catch(function(p){e.onLocalMediaError(p,e.localMediaConstraints)});else if(navigator.getDisplayMedia)navigator.getDisplayMedia(e.localMediaConstraints).then(function(p){p.streamid=p.streamid||p.id||x(),p.idInstance=d,u(p)}).catch(function(p){e.onLocalMediaError(p,e.localMediaConstraints)});else throw new Error("getDisplayMedia API is not availabe in this browser.");return}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(p){p.streamid=p.streamid||p.id||x(),p.idInstance=d,u(p)}).catch(function(p){e.onLocalMediaError(p,e.localMediaConstraints)})}}var _=function(){function e(v){if(!!v){if(typeof v=="string"||typeof v>"u")return v;if(v.audio&&v.video)return null;if(v.audio)return"audio";if(v.video)return"video"}}function d(v,n,o){if(!v||!v.addEventListener)return;if(typeof n>"u"||n==!0){var f="ended";"oninactive"in v&&(f="inactive"),v.addEventListener(f,function(){_.onSyncNeeded(this.streamid,f)},!1)}v.mute=function(a,h){a=e(a),typeof h<"u"&&(n=h),(typeof a>"u"||a=="audio")&&W(v,"audio").forEach(function(y){y.enabled=!1,o.streamEvents[v.streamid].isAudioMuted=!0}),(typeof a>"u"||a=="video")&&W(v,"video").forEach(function(y){y.enabled=!1}),(typeof n>"u"||n==!0)&&_.onSyncNeeded(v.streamid,"mute",a),o.streamEvents[v.streamid].muteType=a||"both",B(v,"mute",a)},v.unmute=function(a,h){a=e(a),typeof h<"u"&&(n=h),p(),(typeof a>"u"||a=="audio")&&W(v,"audio").forEach(function(y){y.enabled=!0,o.streamEvents[v.streamid].isAudioMuted=!1}),(typeof a>"u"||a=="video")&&(W(v,"video").forEach(function(y){y.enabled=!0}),typeof a<"u"&&a=="video"&&o.streamEvents[v.streamid].isAudioMuted&&function y(O){O||(O=0),O++,O<100&&o.streamEvents[v.streamid].isAudioMuted&&(v.mute("audio"),setTimeout(function(){y(O)},50))}()),(typeof n>"u"||n==!0)&&_.onSyncNeeded(v.streamid,"unmute",a),o.streamEvents[v.streamid].unmuteType=a||"both",B(v,"unmute",a)};function p(){if(!!o.streamEvents[v.streamid].mediaElement){var a=o.streamEvents[v.streamid].mediaElement;a.volume=0,u(200,5,function(){try{a.volume+=.2}catch{a.volume=1}})}}}function u(v,n,o,f){f=(f||0)+1,!(f>=n)&&setTimeout(function(){o(),u(v,n,o,f)},v)}return{setHandlers:d,onSyncNeeded:function(v,n,o){}}}();function Xe(e){var d={};function u(v,n,o){var f=v.uuid;if(d[f]||(d[f]=[]),d[f].push(v.message),v.last){var p=d[f].join("");v.isobject&&(p=JSON.parse(p));var a=new Date().getTime(),h=a-v.sendingTime,y={data:p,userid:n,extra:o,latency:h};e.autoTranslateText?(y.original=y.data,e.Translator.TranslateText(y.data,function(O){y.data=O,e.onmessage(y)})):e.onmessage(y),delete d[f]}}return{receive:u}}var Je={send:function(e){var d=e.connection,u=e.channel,v=e.remoteUserId,n=e.text,o=d.chunkSize||1e3,f="",p=!1;le(n)||(p=!0,n=JSON.stringify(n));var a=x(),h=new Date().getTime();y(n);function y(O,A){var r={type:"text",uuid:a,sendingTime:h};O&&(A=O,r.packets=parseInt(A.length/o)),A.length>o?r.message=A.slice(0,o):(r.message=A,r.last=!0,r.isobject=p),u.send(r,v),f=A.slice(r.message.length),f.length&&setTimeout(function(){y(null,f)},d.chunkInterval||100)}}},Le=function(){function e(d){var u={};d.onFileStart=function(n){var o=document.createElement("div");if(o.title=n.name,o.innerHTML="<label>0%</label> <progress></progress>",n.remoteUserId&&(o.innerHTML+=" (Sharing with:"+n.remoteUserId+")"),d.filesContainer||(d.filesContainer=document.body||document.documentElement),d.filesContainer.insertBefore(o,d.filesContainer.firstChild),!n.remoteUserId){u[n.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},u[n.uuid].progress.max=n.maxChunks;return}u[n.uuid]||(u[n.uuid]={}),u[n.uuid][n.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},u[n.uuid][n.remoteUserId].progress.max=n.maxChunks},d.onFileProgress=function(n){var o=u[n.uuid];!o||n.remoteUserId&&(o=u[n.uuid][n.remoteUserId],!o)||(o.progress.value=n.currentPosition||n.maxChunks||o.progress.max,v(o.progress,o.label))},d.onFileEnd=function(n){var o=u[n.uuid];if(!o){console.error("No such progress-helper element exist.",n);return}if(!(n.remoteUserId&&(o=u[n.uuid][n.remoteUserId],!o))){var f=o.div;n.type.indexOf("image")!=-1?f.innerHTML='<a href="'+n.url+'" download="'+n.name+'">Download <strong style="color:red;">'+n.name+'</strong> </a><br /><img src="'+n.url+'" title="'+n.name+'" style="max-width: 80%;">':f.innerHTML='<a href="'+n.url+'" download="'+n.name+'">Download <strong style="color:red;">'+n.name+'</strong> </a><br /><iframe src="'+n.url+'" title="'+n.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'}};function v(n,o){if(n.position!==-1){var f=+n.position.toFixed(2).split(".")[1]||100;o.innerHTML=f+"%"}}}return{handle:e}}(),Ne=function(){function e(d){d.autoTranslateText=!1,d.language="en",d.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",d.Translator={TranslateText:function(u,v){var n=document.createElement("script");n.type="text/javascript";var o=encodeURIComponent(u),f="method"+d.token();window[f]=function(a){if(a.data&&a.data.translations[0]&&v){v(a.data.translations[0].translatedText);return}if(a.error&&a.error.message==="Daily Limit Exceeded"){console.error('Text translation failed. Error message: "Daily Limit Exceeded."');return}if(a.error){console.error(a.error.message);return}console.error(a)};var p="https://www.googleapis.com/language/translate/v2?key="+d.googKey+"&target="+(d.language||"en-US")+"&callback=window."+f+"&q="+o;n.src=p,document.getElementsByTagName("head")[0].appendChild(n)},getListOfLanguages:function(u){var v=new XMLHttpRequest;v.onreadystatechange=function(){if(v.readyState==XMLHttpRequest.DONE){var o=JSON.parse(v.responseText);if(o&&o.data&&o.data.languages){u(o.data.languages);return}if(o.error&&o.error.message==="Daily Limit Exceeded"){console.error('Text translation failed. Error message: "Daily Limit Exceeded."');return}if(o.error){console.error(o.error.message);return}console.error(o)}};var n="https://www.googleapis.com/language/translate/v2/languages?key="+d.googKey+"&target=en";v.open("GET",n,!0),v.send(null)}}}return{handle:e}}();(function(e){z=z||{useDefaultDevices:!0},e.channel=e.sessionid=(U||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split(`
`).join("").split("\r").join(""))+"";var d=new re(e),u={};d.onGettingLocalMedia=function(r,t){if(t=t||function(){},u[r.streamid]){t();return}u[r.streamid]=!0;try{r.type="local"}catch{}e.setStreamEndHandler(r),C(r,function(i){i.id=r.streamid,i.muted=!0,i.volume=0,e.attachStreams.indexOf(r)===-1&&e.attachStreams.push(r),typeof _<"u"&&_.setHandlers(r,!0,e);var s=r.getAudioTracks().filter(function(l){return l.enabled}).length===0;e.streamEvents[r.streamid]={stream:r,type:"local",mediaElement:i,userid:e.userid,extra:e.extra,streamid:r.streamid,isAudioMuted:s};try{T(e,e.streamEvents[r.streamid]),D(e,e.streamEvents[r.streamid]),e.onstream(e.streamEvents[r.streamid])}catch{}t()},e)},d.onGettingRemoteMedia=function(r,t){try{r.type="remote"}catch{}e.setStreamEndHandler(r,"remote-stream"),C(r,function(i){i.id=r.streamid,typeof _<"u"&&_.setHandlers(r,!1,e),e.streamEvents[r.streamid]={stream:r,type:"remote",userid:t,extra:e.peers[t]?e.peers[t].extra:{},mediaElement:i,streamid:r.streamid},D(e,e.streamEvents[r.streamid]),e.onstream(e.streamEvents[r.streamid])},e)},d.onRemovingRemoteMedia=function(r,t){var i=e.streamEvents[r.streamid];i||(i={stream:r,type:"remote",userid:t,extra:e.peers[t]?e.peers[t].extra:{},streamid:r.streamid,mediaElement:e.streamEvents[r.streamid]?e.streamEvents[r.streamid].mediaElement:null}),e.peersBackup[i.userid]&&(i.extra=e.peersBackup[i.userid].extra),e.onstreamended(i),delete e.streamEvents[r.streamid]},d.onNegotiationNeeded=function(r,t,i){i=i||function(){},t=t||r.remoteUserId,r=r||"";var s={remoteUserId:t,message:r,sender:e.userid};r.remoteUserId&&r.message&&r.sender&&(s=r),n(function(){e.socket.emit(e.socketMessageEvent,s,i)})};function v(r){e.deletePeer(r)}d.onUserLeft=v,d.disconnectWith=function(r,t){e.socket&&e.socket.emit("disconnect-with",r,t||function(){}),e.deletePeer(r)},e.socketOptions={transport:"polling"};function n(r){if(e.socketAutoReConnect=!0,e.socket){r&&r(e.socket);return}if(typeof G>"u")if(typeof FirebaseConnection<"u")window.SocketConnection=FirebaseConnection;else if(typeof PubNubConnection<"u")window.SocketConnection=PubNubConnection;else throw"SocketConnection.js seems missed.";new G(e,function(t){r&&r(e.socket)})}e.openOrJoin=function(r,t){t=t||function(){},e.checkPresence(r,function(i,s){if(i){e.sessionid=s;var l=!1,w=!1,P=!!e.session.oneway,M=L(e.session);w={OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},l={OfferToReceiveAudio:P?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:P?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo};var F={remoteUserId:e.sessionid,message:{newParticipationRequest:!0,isOneWay:P,isDataOnly:M,localPeerSdpConstraints:l,remotePeerSdpConstraints:w},sender:e.userid};a(F.message,function(){o(F,t)});return}if(e.waitingForLocalMedia=!0,e.isInitiator=!0,e.sessionid=s||e.sessionid,L(e.session)){f(t);return}e.captureUserMedia(function(){f(t)})})},e.waitingForLocalMedia=!1,e.open=function(r,t){t=t||function(){},e.waitingForLocalMedia=!0,e.isInitiator=!0,e.sessionid=r||e.sessionid,n(function(){if(L(e.session)){f(t);return}e.captureUserMedia(function(){f(t)})})},e.peersBackup={},e.deletePeer=function(r){if(!(!r||!e.peers[r])){var t={userid:r,extra:e.peers[r]?e.peers[r].extra:{}};if(e.peersBackup[t.userid]&&(t.extra=e.peersBackup[t.userid].extra),e.onleave(t),e.peers[r]){e.peers[r].streams.forEach(function(s){s.stop()});var i=e.peers[r].peer;if(i&&i.iceConnectionState!=="closed")try{i.close()}catch{}e.peers[r]&&(e.peers[r].peer=null,delete e.peers[r])}}},e.rejoin=function(r){if(!(e.isInitiator||!r||!Object.keys(r).length)){var t={};e.peers[r.remoteUserId]&&(t=e.peers[r.remoteUserId].extra,e.deletePeer(r.remoteUserId)),r&&r.remoteUserId&&(e.join(r.remoteUserId),e.onReConnecting({userid:r.remoteUserId,extra:t}))}},e.join=function(r,t){e.sessionid=(r?r.sessionid||r.remoteUserId||r:!1)||e.sessionid,e.sessionid+="";var i=!1,s=!1,l=!1,w=!1;if(r&&r.session||!r||typeof r=="string"){var P=r&&r.session||e.session;l=!!P.oneway,w=L(P),s={OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},i={OfferToReceiveAudio:l?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:l?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo}}t=t||{};var M=function(){};typeof t=="function"&&(M=t,t={}),typeof t.localPeerSdpConstraints<"u"&&(i=t.localPeerSdpConstraints),typeof t.remotePeerSdpConstraints<"u"&&(s=t.remotePeerSdpConstraints),typeof t.isOneWay<"u"&&(l=t.isOneWay),typeof t.isDataOnly<"u"&&(w=t.isDataOnly);var F={remoteUserId:e.sessionid,message:{newParticipationRequest:!0,isOneWay:l,isDataOnly:w,localPeerSdpConstraints:i,remotePeerSdpConstraints:s},sender:e.userid};return a(F.message,function(){n(function(){o(F,M)})}),F};function o(r,t){e.socket.emit("join-room",{sessionid:e.sessionid,session:e.session,mediaConstraints:e.mediaConstraints,sdpConstraints:e.sdpConstraints,streams:p(),extra:e.extra,password:typeof e.password<"u"&&typeof e.password!="object"?e.password:""},function(i,s){if(i===!0){if(e.enableLogs&&console.log("isRoomJoined: ",i," roomid: ",e.sessionid),e.peers[e.sessionid])return;d.onNegotiationNeeded(r)}i===!1&&e.enableLogs&&console.warn("isRoomJoined: ",s," roomid: ",e.sessionid),t(i,e.sessionid,s)})}e.publicRoomIdentifier="";function f(r){e.enableLogs&&console.log("Sending open-room signal to socket.io"),e.waitingForLocalMedia=!1,e.socket.emit("open-room",{sessionid:e.sessionid,session:e.session,mediaConstraints:e.mediaConstraints,sdpConstraints:e.sdpConstraints,streams:p(),extra:e.extra,identifier:e.publicRoomIdentifier,password:typeof e.password<"u"&&typeof e.password!="object"?e.password:""},function(t,i){t===!0&&(e.enableLogs&&console.log("isRoomOpened: ",t," roomid: ",e.sessionid),r(t,e.sessionid)),t===!1&&(e.enableLogs&&console.warn("isRoomOpened: ",i," roomid: ",e.sessionid),r(t,e.sessionid,i))})}function p(){try{return e.streamEvents.selectAll("local").map(function(r){return{streamid:r.streamid,tracks:r.stream.getTracks().length}})}catch{return[]}}function a(r,t){if(e.dontCaptureUserMedia||r.isDataOnly){t();return}r.localPeerSdpConstraints.OfferToReceiveAudio&&e.mediaConstraints.audio,r.localPeerSdpConstraints.OfferToReceiveVideo&&e.mediaConstraints.video;var i=r.session||e.session;if(i.oneway&&i.audio!=="two-way"&&i.video!=="two-way"&&i.screen!=="two-way"){t();return}i.oneway&&i.audio&&i.audio==="two-way"&&(i={audio:!0}),(i.audio||i.video||i.screen)&&(i.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:V(e)}).then(function(s){s.isScreen=!0,d.onGettingLocalMedia(s),(i.audio||i.video)&&!V(e)?e.invokeGetUserMedia(null,t):t(s)},function(s){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):e.invokeGetUserMedia({audio:V(e),video:!0,isScreen:!0},(i.audio||i.video)&&!V(e)?e.invokeGetUserMedia(null,t):t):(i.audio||i.video)&&e.invokeGetUserMedia(null,t,i))}e.getUserMedia=e.captureUserMedia=function(r,t){r=r||function(){};var i=t||e.session;if(e.dontCaptureUserMedia||L(i)){r();return}(i.audio||i.video||i.screen)&&(i.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:V(e)}).then(function(s){if(s.isScreen=!0,d.onGettingLocalMedia(s),(i.audio||i.video)&&!V(e)){var l={};for(var w in i)w!=="screen"&&(l[w]=i[w]);e.invokeGetUserMedia(t,r,l);return}r(s)},function(s){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):e.invokeGetUserMedia({audio:V(e),video:!0,isScreen:!0},function(s){if((i.audio||i.video)&&!V(e)){var l={};for(var w in i)w!=="screen"&&(l[w]=i[w]);e.invokeGetUserMedia(t,r,l);return}r(s)}):(i.audio||i.video)&&e.invokeGetUserMedia(t,r,i))},e.onbeforeunload=function(r,t){!e.closeBeforeUnload||(e.peers.getAllParticipants().forEach(function(i){d.onNegotiationNeeded({userLeft:!0},i),e.peers[i]&&e.peers[i].peer&&e.peers[i].peer.close(),delete e.peers[i]}),t||e.closeSocket(),e.isInitiator=!1)},window.ignoreBeforeUnload?e.closeBeforeUnload=!1:(e.closeBeforeUnload=!0,window.addEventListener("beforeunload",e.onbeforeunload,!1)),e.userid=x(),e.changeUserId=function(r,t){t=t||function(){},e.userid=r||x(),e.socket.emit("changed-uuid",e.userid,t)},e.extra={},e.attachStreams=[],e.session={audio:!0,video:!0},e.enableFileSharing=!1,e.bandwidth={screen:!1,audio:!1,video:!1},e.codecs={audio:"opus",video:"VP9"},e.processSdp=function(r){return Ce()||DetectRTC.browser.name==="Safari"||(e.codecs.video.toUpperCase()==="VP8"&&(r=Z.preferCodec(r,"vp8")),e.codecs.video.toUpperCase()==="VP9"&&(r=Z.preferCodec(r,"vp9")),e.codecs.video.toUpperCase()==="H264"&&(r=Z.preferCodec(r,"h264")),e.codecs.audio==="G722"&&(r=Z.removeNonG722(r)),DetectRTC.browser.name==="Firefox")||((e.bandwidth.video||e.bandwidth.screen)&&(r=Z.setApplicationSpecificBandwidth(r,e.bandwidth,!!e.session.screen)),e.bandwidth.video&&(r=Z.setVideoBitrates(r,{min:e.bandwidth.video*8*1024,max:e.bandwidth.video*8*1024})),e.bandwidth.audio&&(r=Z.setOpusAttributes(r,{maxaveragebitrate:e.bandwidth.audio*8*1024,maxplaybackrate:e.bandwidth.audio*8*1024,stereo:1,maxptime:3}))),r},typeof Z<"u"&&(e.BandwidthHandler=e.CodecsHandler=Z),e.mediaConstraints={audio:{mandatory:{},optional:e.bandwidth.audio?[{bandwidth:e.bandwidth.audio*8*1024||1048576}]:[]},video:{mandatory:{},optional:e.bandwidth.video?[{bandwidth:e.bandwidth.video*8*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},DetectRTC.browser.name==="Firefox"&&(e.mediaConstraints={audio:!0,video:!0}),!z.useDefaultDevices&&!DetectRTC.isMobileDevice&&DetectRTC.load(function(){var r,t;if(DetectRTC.MediaDevices.forEach(function(s){s.kind==="audioinput"&&e.mediaConstraints.audio!==!1&&(r=s),s.kind==="videoinput"&&e.mediaConstraints.video!==!1&&(t=s)}),r){if(DetectRTC.browser.name==="Firefox"){e.mediaConstraints.audio!==!0?e.mediaConstraints.audio.deviceId=r.id:e.mediaConstraints.audio={deviceId:r.id};return}e.mediaConstraints.audio==!0&&(e.mediaConstraints.audio={mandatory:{},optional:[]}),e.mediaConstraints.audio.optional||(e.mediaConstraints.audio.optional=[]);var i=[{sourceId:r.id}];e.mediaConstraints.audio.optional=i.concat(e.mediaConstraints.audio.optional)}if(t){if(DetectRTC.browser.name==="Firefox"){e.mediaConstraints.video!==!0?e.mediaConstraints.video.deviceId=t.id:e.mediaConstraints.video={deviceId:t.id};return}e.mediaConstraints.video==!0&&(e.mediaConstraints.video={mandatory:{},optional:[]}),e.mediaConstraints.video.optional||(e.mediaConstraints.video.optional=[]);var i=[{sourceId:t.id}];e.mediaConstraints.video.optional=i.concat(e.mediaConstraints.video.optional)}}),e.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},e.sdpSemantics=null,e.iceCandidatePoolSize=null,e.bundlePolicy=null,e.rtcpMuxPolicy=null,e.iceTransportPolicy=null,e.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},e.iceServers=ze.getIceServers(e),e.candidates={host:!0,stun:!0,turn:!0},e.iceProtocols={tcp:!0,udp:!0},e.onopen=function(r){e.enableLogs&&console.info("Data connection has been opened between you & ",r.userid)},e.onclose=function(r){e.enableLogs&&console.warn("Data connection has been closed between you & ",r.userid)},e.onerror=function(r){e.enableLogs&&console.error(r.userid,"data-error",r)},e.onmessage=function(r){e.enableLogs&&console.debug("data-message",r.userid,r.data)},e.send=function(r,t){e.peers.send(r,t)},e.close=e.disconnect=e.leave=function(){e.onbeforeunload(!1,!0)},e.closeEntireSession=function(r){r=r||function(){},e.socket.emit("close-entire-session",function t(){if(e.getAllParticipants().length){setTimeout(t,100);return}e.onEntireSessionClosed({sessionid:e.sessionid,userid:e.userid,extra:e.extra}),e.changeUserId(null,function(){e.close(),r()})})},e.onEntireSessionClosed=function(r){!e.enableLogs||console.info("Entire session is closed: ",r.sessionid,r.extra)},e.onstream=function(r){var t=e.videosContainer;t.insertBefore(r.mediaElement,t.firstChild);var i=r.mediaElement.play();if(typeof i<"u"){i.catch(function(){}).then(function(){setTimeout(function(){r.mediaElement.play()},2e3)});return}setTimeout(function(){r.mediaElement.play()},2e3)},e.onstreamended=function(r){r.mediaElement||(r.mediaElement=document.getElementById(r.streamid)),!(!r.mediaElement||!r.mediaElement.parentNode)&&r.mediaElement.parentNode.removeChild(r.mediaElement)},e.direction="many-to-many",e.removeStream=function(r,t){var i,s;if(e.attachStreams.forEach(function(l,w){l.id===r&&(i=l,s=w)}),!i){console.warn("No such stream exist.",r);return}e.peers.getAllParticipants().forEach(function(l){if(!(t&&l!==t)){var w=e.peers[l];try{w.peer.removeStream(i)}catch{}}}),s!==-1&&(delete e.attachStreams[s],console.log("Stream removed from attachStreams",e.attachStreams)),e.renegotiate()},e.addStream=function(r,t){if(r.getTracks){e.attachStreams.indexOf(r)===-1&&(r.streamid||(r.streamid=r.id),e.attachStreams.push(r)),e.renegotiate(t);return}if(L(r)){e.renegotiate(t);return}(r.audio||r.video||r.screen)&&(r.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:V(e)}).then(function(s){s.isScreen=!0,d.onGettingLocalMedia(s),(r.audio||r.video)&&!V(e)?e.invokeGetUserMedia(null,function(l){i(l)}):i(s)},function(s){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):e.invokeGetUserMedia({audio:V(e),video:!0,isScreen:!0},function(s){(r.audio||r.video)&&!V(e)?e.invokeGetUserMedia(null,function(l){i(l)}):i(s)}):(r.audio||r.video)&&e.invokeGetUserMedia(null,i));function i(s){r.streamCallback&&r.streamCallback(s),e.renegotiate(t)}},e.invokeGetUserMedia=function(r,t,i){i||(i=e.session),r||(r=e.mediaConstraints),xe({onGettingLocalMedia:function(s){var l=r.video;l&&(l.mediaSource||l.mozMediaSource||l.mandatory&&l.mandatory.chromeMediaSource)&&(s.isScreen=!0),s.isScreen||(s.isVideo=!!W(s,"video").length,s.isAudio=!s.isVideo&&W(s,"audio").length),d.onGettingLocalMedia(s,function(){typeof t=="function"&&t(s)})},onLocalMediaError:function(s,l){d.onLocalMediaError(s,l)},localMediaConstraints:r||{audio:i.audio?r.audio:!1,video:i.video?r.video:!1}})};function h(r,t){if(!r){e.enableLogs&&console.error("No stream to applyConstraints.");return}t.audio&&W(r,"audio").forEach(function(i){i.applyConstraints(t.audio)}),t.video&&W(r,"video").forEach(function(i){i.applyConstraints(t.video)})}e.applyConstraints=function(r,t){if(!Q||!Q.prototype.applyConstraints){alert("track.applyConstraints is NOT supported in your browser.");return}if(t){var i;e.streamEvents[t]&&(i=e.streamEvents[t].stream),h(i,r);return}e.attachStreams.forEach(function(s){h(s,r)})};function y(r,t,i,s){if(t){d.replaceTrack(r,t,i,s);return}e.peers.getAllParticipants().forEach(function(l){d.replaceTrack(r,l,i,s)})}e.replaceTrack=function(r,t,i,s){if(r=r||{},!I.prototype.getSenders){e.addStream(r);return}if(r instanceof Q){y(r,t,i,s);return}if(r instanceof K){W(r,"video").length&&y(W(r,"video")[0],t,!0,s),W(r,"audio").length&&y(W(r,"audio")[0],t,!1,s);return}if(L(r))throw"connection.replaceTrack requires audio and/or video and/or screen.";(r.audio||r.video||r.screen)&&(r.screen?DetectRTC.browser.name==="Edge"?navigator.getDisplayMedia({video:!0,audio:V(e)}).then(function(w){w.isScreen=!0,d.onGettingLocalMedia(w),(r.audio||r.video)&&!V(e)?e.invokeGetUserMedia(null,l):l(w)},function(w){console.error("Unable to capture screen on Edge. HTTPs and version 17+ is required.")}):e.invokeGetUserMedia({audio:V(e),video:!0,isScreen:!0},(r.audio||r.video)&&!V(e)?e.invokeGetUserMedia(null,l):l):(r.audio||r.video)&&e.invokeGetUserMedia(null,l));function l(w){e.replaceTrack(w,t,i||r.video||r.screen,s)}},e.resetTrack=function(r,t){r||(r=e.getAllParticipants()),typeof r=="string"&&(r=[r]),r.forEach(function(i){var s=e.peers[i].peer;(typeof t>"u"||t===!0)&&s.lastVideoTrack&&e.replaceTrack(s.lastVideoTrack,i,!0),(typeof t>"u"||t===!1)&&s.lastAudioTrack&&e.replaceTrack(s.lastAudioTrack,i,!1)})},e.renegotiate=function(r){if(r){d.renegotiatePeer(r);return}e.peers.getAllParticipants().forEach(function(t){d.renegotiatePeer(t)})},e.setStreamEndHandler=function(r,t){if(!(!r||!r.addEventListener)&&(t=!!t,!r.alreadySetEndHandler)){r.alreadySetEndHandler=!0;var i="ended";"oninactive"in r&&(i="inactive"),r.addEventListener(i,function(){if(r.idInstance&&currentUserMediaRequest.remove(r.idInstance),!t){var s=[];e.attachStreams.forEach(function(P){P.id!=r.id&&s.push(P)}),e.attachStreams=s}var l=e.streamEvents[r.streamid];if(l||(l={stream:r,streamid:r.streamid,type:t?"remote":"local",userid:e.userid,extra:e.extra,mediaElement:e.streamEvents[r.streamid]?e.streamEvents[r.streamid].mediaElement:null}),t&&e.peers[l.userid]){var w=e.peers[l.userid].peer,s=[];w.getRemoteStreams().forEach(function(M){M.id!=r.id&&s.push(M)}),e.peers[l.userid].streams=s}l.userid===e.userid&&l.type==="remote"||(e.peersBackup[l.userid]&&(l.extra=e.peersBackup[l.userid].extra),e.onstreamended(l),delete e.streamEvents[r.streamid])},!1)}},e.onMediaError=function(r,t){e.enableLogs&&console.error(r,t)},e.autoCloseEntireSession=!1,e.filesContainer=e.videosContainer=document.body||document.documentElement,e.isInitiator=!1,e.shareFile=d.shareFile,typeof Le<"u"&&Le.handle(e),typeof Ne<"u"&&Ne.handle(e),e.token=x,e.onNewParticipant=function(r,t){e.acceptParticipationRequest(r,t)},e.acceptParticipationRequest=function(r,t){t.successCallback&&(t.successCallback(),delete t.successCallback),d.createNewPeer(r,t)},typeof _<"u"&&(e.StreamsHandler=_),e.onleave=function(r){},e.invokeSelectFileDialog=function(r){var t=new FileSelector;t.accept="*.*",t.selectSingleFile(r)},e.onmute=function(r){if(!(!r||!r.mediaElement))if(r.muteType==="both"||r.muteType==="video"){r.mediaElement.src=null;var t=r.mediaElement.pause();typeof t<"u"?t.then(function(){r.mediaElement.poster=r.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):r.mediaElement.poster=r.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else r.muteType==="audio"&&(r.mediaElement.muted=!0)},e.onunmute=function(r){!r||!r.mediaElement||!r.stream||(r.unmuteType==="both"||r.unmuteType==="video"?(r.mediaElement.poster=null,r.mediaElement.srcObject=r.stream,r.mediaElement.play()):r.unmuteType==="audio"&&(r.mediaElement.muted=!1))},e.onExtraDataUpdated=function(r){r.status="online",e.onUserStatusChanged(r,!0)},e.getAllParticipants=function(r){return e.peers.getAllParticipants(r)},typeof _<"u"&&(_.onSyncNeeded=function(r,t,i){e.peers.getAllParticipants().forEach(function(s){d.onNegotiationNeeded({streamid:r,action:t,streamSyncNeeded:!0,type:i||"both"},s)})}),e.connectSocket=function(r){n(r)},e.closeSocket=function(){try{io.sockets={}}catch{}!e.socket||(typeof e.socket.disconnect=="function"&&e.socket.disconnect(),typeof e.socket.resetProps=="function"&&e.socket.resetProps(),e.socket=null)},e.getSocket=function(r){return!r&&e.enableLogs&&console.warn("getSocket.callback paramter is required."),r=r||function(){},e.socket?r(e.socket):n(function(){r(e.socket)}),e.socket},e.getRemoteStreams=d.getRemoteStreams;var O=["selectFirst","selectAll","forEach"];if(e.streamEvents={selectFirst:function(r){return e.streamEvents.selectAll(r)[0]},selectAll:function(r){r||(r={local:!0,remote:!0,isScreen:!0,isAudio:!0,isVideo:!0}),r=="local"&&(r={local:!0}),r=="remote"&&(r={remote:!0}),r=="screen"&&(r={isScreen:!0}),r=="audio"&&(r={isAudio:!0}),r=="video"&&(r={isVideo:!0});var t=[];return Object.keys(e.streamEvents).forEach(function(i){var s=e.streamEvents[i];if(O.indexOf(i)===-1){var l=!0;r.local&&s.type==="local"&&(l=!1),r.remote&&s.type==="remote"&&(l=!1),r.isScreen&&s.stream.isScreen&&(l=!1),r.isVideo&&s.stream.isVideo&&(l=!1),r.isAudio&&s.stream.isAudio&&(l=!1),r.userid&&s.userid===r.userid&&(l=!1),l===!1&&t.push(s)}}),t}},e.socketURL="/",e.socketMessageEvent="RTCMultiConnection-Message",e.socketCustomEvent="RTCMultiConnection-Custom-Message",e.DetectRTC=DetectRTC,e.setCustomSocketEvent=function(r){r&&(e.socketCustomEvent=r),e.socket&&e.socket.emit("set-custom-socket-event-listener",e.socketCustomEvent)},e.getNumberOfBroadcastViewers=function(r,t){!e.socket||!r||!t||e.socket.emit("get-number-of-users-in-specific-broadcast",r,t)},e.onNumberOfBroadcastViewersUpdated=function(r){!e.enableLogs||!e.isInitiator||console.info("Number of broadcast (",r.broadcastId,") viewers",r.numberOfBroadcastViewers)},e.onUserStatusChanged=function(r,t){!!e.enableLogs&&!t&&console.info(r.userid,r.status)},e.getUserMediaHandler=xe,e.multiPeersHandler=d,e.enableLogs=!0,e.setCustomSocketHandler=function(r){typeof G<"u"&&(G=r)},e.chunkSize=4e4,e.maxParticipantsAllowed=1e3,e.disconnectWith=d.disconnectWith,e.checkPresence=function(r,t){if(r=r||e.sessionid,G.name==="SSEConnection"){SSEConnection.checkPresence(r,function(i,s,l){if(!e.socket){i||(e.userid=s),e.connectSocket(function(){t(i,s,l)});return}t(i,s)});return}if(!e.socket){e.connectSocket(function(){e.checkPresence(r,t)});return}e.socket.emit("check-presence",r+"",function(i,s,l){e.enableLogs&&console.log("checkPresence.isRoomExist: ",i," roomid: ",s),t(i,s,l)})},e.onReadyForOffer=function(r,t){e.multiPeersHandler.createNewPeer(r,t)},e.setUserPreferences=function(r){return e.dontAttachStream&&(r.dontAttachLocalStream=!0),e.dontGetRemoteStream&&(r.dontGetRemoteStream=!0),r},e.updateExtraData=function(){e.socket.emit("extra-data-updated",e.extra)},e.enableScalableBroadcast=!1,e.maxRelayLimitPerUser=3,e.dontCaptureUserMedia=!1,e.dontAttachStream=!1,e.dontGetRemoteStream=!1,e.onReConnecting=function(r){e.enableLogs&&console.info("ReConnecting with",r.userid,"...")},e.beforeAddingStream=function(r){return r},e.beforeRemovingStream=function(r){return r},typeof isChromeExtensionAvailable<"u"&&(e.checkIfChromeExtensionAvailable=isChromeExtensionAvailable),typeof isFirefoxExtensionAvailable<"u"&&(e.checkIfChromeExtensionAvailable=isFirefoxExtensionAvailable),typeof getChromeExtensionStatus<"u"&&(e.getChromeExtensionStatus=getChromeExtensionStatus),e.modifyScreenConstraints=function(r){return r},e.onPeerStateChanged=function(r){e.enableLogs&&r.iceConnectionState.search(/closed|failed/gi)!==-1&&console.error("Peer connection is closed between you & ",r.userid,r.extra,"state:",r.iceConnectionState)},e.isOnline=!0,R("online",function(){e.isOnline=!0}),R("offline",function(){e.isOnline=!1}),e.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(e.isLowBandwidth=navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g)!==-1,e.isLowBandwidth)){if(e.bandwidth={audio:!1,video:!1,screen:!1},e.mediaConstraints.audio&&e.mediaConstraints.audio.optional&&e.mediaConstraints.audio.optional.length){var A=[];e.mediaConstraints.audio.optional.forEach(function(r){typeof r.bandwidth>"u"&&A.push(r)}),e.mediaConstraints.audio.optional=A}if(e.mediaConstraints.video&&e.mediaConstraints.video.optional&&e.mediaConstraints.video.optional.length){var A=[];e.mediaConstraints.video.optional.forEach(function(t){typeof t.bandwidth>"u"&&A.push(t)}),e.mediaConstraints.video.optional=A}}e.getExtraData=function(r,t){if(!r)throw"remoteUserId is required.";if(typeof t=="function"){e.socket.emit("get-remote-user-extra-data",r,function(i,s,l){t(i,s,l)});return}return e.peers[r]?e.peers[r].extra:e.peersBackup[r]?e.peersBackup[r].extra:{}},z.autoOpenOrJoin&&e.openOrJoin(e.sessionid),e.onUserIdAlreadyTaken=function(r,t){e.close(),e.closeSocket(),e.isInitiator=!1,e.userid=e.token(),e.join(e.sessionid),e.enableLogs&&console.warn("Userid already taken.",r,"Your new userid:",e.userid)},e.trickleIce=!0,e.version="3.7.0",e.onSettingLocalDescription=function(r){e.enableLogs&&console.info("Set local description for remote user",r.userid)},e.resetScreen=function(){sourceId=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},e.autoCreateMediaElement=!0,e.password=null,e.setPassword=function(r,t){t=t||function(){},e.socket?e.socket.emit("set-password",r,t):(e.password=r,t(!0,e.sessionid,null))},e.onSocketDisconnect=function(r){e.enableLogs&&console.warn("socket.io connection is closed")},e.onSocketError=function(r){e.enableLogs&&console.warn("socket.io connection is failed")},e.errors={ROOM_NOT_AVAILABLE:"Room not available",INVALID_PASSWORD:"Invalid password",USERID_NOT_AVAILABLE:"User ID does not exist",ROOM_PERMISSION_DENIED:"Room permission denied",ROOM_FULL:"Room full",DID_NOT_JOIN_ANY_ROOM:"Did not join any room yet",INVALID_SOCKET:"Invalid socket",PUBLIC_IDENTIFIER_MISSING:"publicRoomIdentifier is required",INVALID_ADMIN_CREDENTIAL:"Invalid username or password attempted"}})(this)};typeof module<"u"&&(module.exports=exports=He);typeof define=="function"&&define.amd&&define("RTCMultiConnection",[],function(){return He});(function(U){if(typeof bootstrap=="function")bootstrap("hark",U);else if(typeof exports=="object")module.exports=U();else if(typeof define=="function"&&define.amd)define(U);else if(typeof ses<"u"){if(!ses.ok())return;ses.makeHark=U}else typeof window<"u"?window.hark=U():global.hark=U()})(function(){return function(U,z,ae){function G(T,D){if(!z[T]){if(!U[T]){var x=typeof require=="function"&&require;if(!D&&x)return x(T,!0);if(re)return re(T,!0);throw new Error("Cannot find module '"+T+"'")}var C=z[T]={exports:{}};U[T][0].call(C.exports,function(R){var N=U[T][1][R];return G(N||R)},C,C.exports)}return z[T].exports}for(var re=typeof require=="function"&&require,B=0;B<ae.length;B++)G(ae[B]);return G}({1:[function(U,z,ae){var G=U("wildemitter");function re(D,x){var C=-1/0;D.getFloatFrequencyData(x);for(var R=4,N=x.length;R<N;R++)x[R]>C&&x[R]<0&&(C=x[R]);return C}var B;typeof window<"u"&&(B=window.AudioContext||window.webkitAudioContext);var T=null;z.exports=function(D,R){var C=new G;if(!B)return C;var R=R||{},N=R.smoothing||.1,L=R.interval||50,q=R.threshold,le=R.play,K=R.history||10,V=!0;T=R.audioContext||T||new B;var W,Ce,Y;Y=T.createAnalyser(),Y.fftSize=512,Y.smoothingTimeConstant=N,Ce=new Float32Array(Y.frequencyBinCount),D.jquery&&(D=D[0]),D instanceof HTMLAudioElement||D instanceof HTMLVideoElement?(W=T.createMediaElementSource(D),typeof le>"u"&&(le=!0),q=q||-50):(W=T.createMediaStreamSource(D),q=q||-50),W.connect(Y),le&&Y.connect(T.destination),C.speaking=!1,C.suspend=function(){return T.suspend()},C.resume=function(){return T.resume()},Object.defineProperty(C,"state",{get:function(){return T.state}}),T.onstatechange=function(){C.emit("state_change",T.state)},C.setThreshold=function(j){q=j},C.setInterval=function(j){L=j},C.stop=function(){V=!1,C.emit("volume_change",-100,q),C.speaking&&(C.speaking=!1,C.emit("stopped_speaking")),Y.disconnect(),W.disconnect()},C.speakingHistory=[];for(var pe=0;pe<K;pe++)C.speakingHistory.push(0);var ie=function(){setTimeout(function(){if(!!V){var j=re(Y,Ce);C.emit("volume_change",j,q);var I=0;if(j>q&&!C.speaking){for(var $=C.speakingHistory.length-3;$<C.speakingHistory.length;$++)I+=C.speakingHistory[$];I>=2&&(C.speaking=!0,C.emit("speaking"))}else if(j<q&&C.speaking){for(var $=0;$<C.speakingHistory.length;$++)I+=C.speakingHistory[$];I==0&&(C.speaking=!1,C.emit("stopped_speaking"))}C.speakingHistory.shift(),C.speakingHistory.push(0+(j>q)),ie()}},L)};return ie(),C}},{wildemitter:2}],2:[function(U,z,ae){z.exports=G;function G(){}G.mixin=function(re){var B=re.prototype||re;B.isWildEmitter=!0,B.on=function(T,D,x){this.callbacks=this.callbacks||{};var C=arguments.length===3,R=C?arguments[1]:void 0,N=C?arguments[2]:arguments[1];return N._groupName=R,(this.callbacks[T]=this.callbacks[T]||[]).push(N),this},B.once=function(T,D,x){var C=this,R=arguments.length===3,N=R?arguments[1]:void 0,L=R?arguments[2]:arguments[1];function q(){C.off(T,q),L.apply(this,arguments)}return this.on(T,N,q),this},B.releaseGroup=function(T){this.callbacks=this.callbacks||{};var D,x,C,R;for(D in this.callbacks)for(R=this.callbacks[D],x=0,C=R.length;x<C;x++)R[x]._groupName===T&&(R.splice(x,1),x--,C--);return this},B.off=function(T,D){this.callbacks=this.callbacks||{};var x=this.callbacks[T],C;return x?arguments.length===1?(delete this.callbacks[T],this):(C=x.indexOf(D),x.splice(C,1),x.length===0&&delete this.callbacks[T],this):this},B.emit=function(T){this.callbacks=this.callbacks||{};var D=[].slice.call(arguments,1),x=this.callbacks[T],C=this.getWildcardCallbacks(T),R,N,L;if(x)for(L=x.slice(),R=0,N=L.length;R<N&&L[R];++R)L[R].apply(this,D);if(C)for(N=C.length,L=C.slice(),R=0,N=L.length;R<N&&L[R];++R)L[R].apply(this,[T].concat(D));return this},B.getWildcardCallbacks=function(T){this.callbacks=this.callbacks||{};var D,x,C=[];for(D in this.callbacks)x=D.split("*"),(D==="*"||x.length===2&&T.slice(0,x[0].length)===x[0])&&(C=C.concat(this.callbacks[D]));return C}},G.mixin(G)},{}]},{},[1])(1)});export{He as R};
