import{m as n,i as l}from"./vendor/vendor-core.3574f8d9.js";import{F as g}from"./FileUploader.78ddb8c0.js";import{E as p}from"./vendor/vendor-vue-emoji-picker.16de4f23.js";import{n as c}from"./_plugin-vue2_normalizer.7b9a2fe2.js";import{f as v}from"./config-form.362d01c5.js";import{n as f}from"./momentz.ae4aeebe.js";import{b as C}from"./media.60d422e2.js";import{c as b,S as u,e as w,h as T,i as R,f as y}from"./app.a373aa59.js";import{E as d}from"./event-bus.6a5776a8.js";const M={props:{activeContainer:{type:String,default:"home",required:!0},configs:{type:Object,required:!0},fullPage:{type:Boolean,default:!1},restrict:{type:Boolean,default:!1}},computed:{computedTitle(){return this.activeContainer==="settings"?$t("config.chat.chat_config"):this.activeContainer==="chatgroup"?$t("chat.chat_group"):$t("chat.live_chat")}}};var S=function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-box-header"},[t("h6",{staticClass:"cb-header-title"},[e._v(e._s(e.computedTitle))]),t("div",{staticClass:"cb-header-buttons action-buttons"},[e.activeContainer==="chatgroup"?[t("button",{attrs:{type:"button"},on:{click:function(a){return e.$emit("goBack")}}},[t("i",{class:["fas",{"fa-chevron-left":e.activeContainer==="chatgroup"}]})]),t("button",{staticClass:"auto-width",attrs:{type:"button"},on:{click:function(a){return e.$emit("showAddMemberScreen")}}},[t("i",{staticClass:"fas fa-plus"}),e._v(" "),t("span",{staticClass:"px-2"},[e._v(e._s(e.$t("chat.add")))])])]:[e.activeContainer!=="home"&&!e.restrict?t("button",{attrs:{type:"button"},on:{click:function(a){return e.$emit("goHome")}}},[t("i",{class:["fas",{"fa-chevron-left":e.activeContainer==="conversation"},{"fa-chevron-right":e.activeContainer==="settings"}]})]):e.activeContainer==="settings"?t("button",{attrs:{type:"button"},on:{click:function(a){return e.$emit("goHome")}}},[t("i",{staticClass:"fas fa-chevron-right"})]):e._e(),e.activeContainer!=="settings"?[t("button",{attrs:{type:"button"},on:{click:function(a){return e.$emit("toggleSearch")}}},[t("i",{staticClass:"fas fa-search"})]),t("button",{attrs:{type:"button"},on:{click:function(a){return e.$emit("goToSettings")}}},[t("i",{staticClass:"fas fa-cog"})])]:e._e(),e.activeContainer==="home"&&!e.fullPage&&e.configs.chat.separateWindow?t("router-link",{staticClass:"button",attrs:{to:{name:"appChat"}}},[t("i",{staticClass:"fas fa-external-link-alt"})]):e._e()],e.fullPage?e._e():t("button",{attrs:{type:"button"},on:{click:function(a){return e.$emit("hideChatBox")}}},[t("i",{staticClass:"fas fa-times"})])],2)])},U=[],$=c(M,S,U,!1,null,null,null,null);const x=$.exports;const k={extends:v,props:{activeContainer:{type:String,default:"home",required:!0}},watch:{activeContainer(s,e){s==="settings"&&s!==e&&(this.formData=Object.assign({},this.formData,_.cloneDeep(this.initialFormData)))}},data(){return{now:f({moment:!0}),formData:{chat:{enableAutoOpen:!1,enterToSubmit:!1,muteSoundNotification:!1},override:!0},useUserPreference:!0}},methods:{afterSubmitSuccess(){this.$emit("goHome")}}};var G=function(){var e=this,t=e._self._c;return t("div",{staticClass:"cb-inner-window settings-container"},[e.activeContainer==="settings"?t("div",{staticClass:"settings-wrapper"},[t("div",{staticClass:"settings"},[t("vue-scroll",{ref:"vue-scroll-settings",attrs:{id:"vue-scroll-settings"}},[t("div",{staticClass:"settings-list"},[t("switch-wrapper",{staticClass:"text-light",attrs:{label:e.$t("config.chat.enable_auto_open")}},[t("base-switch",{attrs:{design:"success"},model:{value:e.formData.chat.enableAutoOpen,callback:function(a){e.$set(e.formData.chat,"enableAutoOpen",a)},expression:"formData.chat.enableAutoOpen"}})],1),t("switch-wrapper",{staticClass:"text-light",attrs:{label:e.$t("config.chat.enter_to_submit")}},[t("base-switch",{attrs:{design:"success"},model:{value:e.formData.chat.enterToSubmit,callback:function(a){e.$set(e.formData.chat,"enterToSubmit",a)},expression:"formData.chat.enterToSubmit"}})],1),t("switch-wrapper",{staticClass:"text-light",attrs:{label:e.$t("config.chat.mute_sound_notification")}},[t("base-switch",{attrs:{design:"success"},model:{value:e.formData.chat.muteSoundNotification,callback:function(a){e.$set(e.formData.chat,"muteSoundNotification",a)},expression:"formData.chat.muteSoundNotification"}})],1)],1)])],1),t("div",{staticClass:"settings-footer"},[t("base-button",{attrs:{type:"button",design:"primary",size:"block"},on:{click:e.submit}},[e._v(e._s(e.$t("general.save")))])],1)]):e._e()])},A=[],D=c(k,G,A,!1,null,null,null,null);const E=D.exports;const O={props:{activeContainer:{type:String,default:"home",required:!0},activeGroup:{type:[Object,null],default(){return null}},membersToAdd:{type:Array,default(){return[]}},membersToRemove:{type:Array,default(){return[]}}},data(){return{formData:{uuid:null,name:"",isPublicGroup:!1,members:[]},showEditNameForm:!1,isLoading:!1}},watch:{activeContainer(s,e){s==="chatgroup"&&s!==e&&(this.activeGroup||(this.formData.uuid=null,this.formData.name="",this.formData.isPublicGroup=!1,this.formData.members=[]))},activeGroup(s,e){e!==s&&(s?(this.formData.uuid=s.uuid,this.formData.name=s.name,this.formData.members=s.members,this.getMembers()):(this.formData.uuid=null,this.formData.name="",this.formData.isPublicGroup=!1,this.formData.members=[]))},membersToAdd:{handler(s){!(s&&s.length)||s.forEach(e=>{this.formData.members.findIndex(a=>a.user.uuid===e.user.uuid)===-1&&this.formData.members.push({...e})})},deep:!0},membersToRemove:{handler(s){!(s&&s.length)||s.forEach(e=>{const t=this.formData.members.findIndex(a=>a.user.uuid===e.user.uuid);t!==-1&&this.formData.members.splice(t,1)})},deep:!0}},computed:{...n("user",["hasRole"]),...n("config",["configs"])},methods:{...l("chat",["CreateRoom","UpdateRoom","GetRoomMembers"]),goBack(){this.formData.uuid=null,this.formData.name="",this.formData.isPublicGroup=!1,this.formData.members=[],this.$emit("goBack")},editName(){this.showEditNameForm=!0},updateName(){this.isLoading=!0,this.UpdateRoom({uuid:this.formData.uuid,name:this.formData.name}).then(s=>{this.isLoading=!1,this.showEditNameForm=!1}).catch(s=>{this.isLoading=!1,formUtil.handleErrors(s)})},createGroup(){this.isLoading=!0,this.CreateRoom({name:this.formData.name,isPublicGroup:this.formData.isPublicGroup,members:this.formData.members.map(s=>s.user)}).then(s=>{this.isLoading=!1,this.$emit("goToConversation",{room:s,user:null})}).catch(s=>{this.isLoading=!1,formUtil.handleErrors(s)})},getMembers(){!this.activeGroup||(this.isLoading=!0,this.GetRoomMembers({uuid:this.activeGroup.uuid}).then(s=>{this.isLoading=!1,this.formData.members=s}).catch(s=>{this.isLoading=!1,formUtil.handleErrors(s)}))}},mounted(){this.activeGroup&&this.getMembers()}};var F=function(){var e=this,t=e._self._c;return t("div",{staticClass:"cb-inner-window chatgroup-container"},[e.activeContainer==="chatgroup"?t("div",{staticClass:"chatgroup-wrapper"},[t("div",{staticClass:"chatgroup"},[t("vue-scroll",{ref:"vue-scroll-chatgroup",attrs:{id:"vue-scroll-chatgroup"}},[t("div",{staticClass:"chatgroup-form"},[e.activeGroup?[e.showEditNameForm?e.activeGroup.canModerate?t("div",{staticClass:"chatgroup-name mt-2"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.name,expression:"formData.name"}],ref:"groupName",staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("chat.chat_group_name")},domProps:{value:e.formData.name},on:{input:function(a){a.target.composing||e.$set(e.formData,"name",a.target.value)}}}),t("div",{staticClass:"chatgroup-actions"},[t("button",{attrs:{type:"button"},on:{click:e.updateName}},[t("i",{staticClass:"fas fa-check"})])])]):e._e():t("div",{staticClass:"chatgroup-name mt-2"},[t("h6",[e._v(e._s(e.formData.name))]),e.activeGroup.canModerate?t("div",{staticClass:"chatgroup-actions"},[t("button",{attrs:{type:"button"},on:{click:e.editName}},[t("i",{staticClass:"fas fa-pencil-alt"})])]):e._e()])]:[t("div",{staticClass:"chatgroup-name"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.formData.name,expression:"formData.name"}],ref:"groupName",staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("chat.chat_group_name")},domProps:{value:e.formData.name},on:{input:function(a){a.target.composing||e.$set(e.formData,"name",a.target.value)}}})]),e.configs.chat.allowPublicGroupChat?[e.hasRole("admin")?t("base-checkbox",{staticClass:"ml-3 mt-4",model:{value:e.formData.isPublicGroup,callback:function(a){e.$set(e.formData,"isPublicGroup",a)},expression:"formData.isPublicGroup"}},[t("span",{staticClass:"text-light"},[e._v(e._s(e.$t("chat.is_public_group"))+"?")])]):e._e(),t("p",{staticClass:"ml-3 mt-1 text-muted text-sm"},[e._v(e._s(e.$t("chat.public_chat_group_helper_info")))])]:e._e()],t("div",{staticClass:"chatgroup-members-header pt-3"}),t("div",{staticClass:"chatgroup-members"},[e._t("members",null,{members:e.formData.members})],2)],2)])],1),e.activeGroup?e._e():t("div",{staticClass:"chatgroup-footer"},[t("base-button",{attrs:{type:"button",design:"dark-primary"},on:{click:e.goBack}},[e._v(e._s(e.$t("general.cancel")))]),t("base-button",{attrs:{type:"button",design:"primary"},on:{click:e.createGroup}},[e._v(e._s(e.$t("general.save")))])],1)]):e._e()])},L=[],B=c(O,F,L,!1,null,null,null,null);const I=B.exports,P={props:{room:{type:Object,required:!0},roomName:{type:String,required:!0},showLastMessage:{type:Boolean,default:!0},clickAction:{type:String,default:"goToConversation"},showCustomAction:{type:Boolean,default:!1},clickActionOnCustom:{type:String,default:"removeMember"},customActionIcon:{type:String,default:"fas fa-times"},vars:{type:Object,default(){return{}}}},computed:{...n("user",{userUuid:"uuid"}),computedAvatar(){return this.room.isGroup||!this.room.member?this.room:this.room.member}},methods:{removeHtmlTags(s){if(!s)return s;s=s.replace(/<(?!\/?>)[^>]+>/gmi," ").replace(/\s+/gmi," ");let e=document.createElement("DIV");return e.innerHTML=s,e.textContent||e.innerText||""},onClickRoomItem(){this.computedAvatar.uuid!==this.userUuid&&(this.clickAction==="addToGroup"?this.$emit(this.clickAction,{room:null,user:this.room.member?this.room.member:this.room}):this.room.isGroup||this.room.member?this.$emit(this.clickAction,{room:this.room,user:null}):this.$emit(this.clickAction,{room:null,user:this.room}))},doCustomAction(){this.$emit(this.clickActionOnCustom,{room:this.room,user:this.room.member?this.room.member:this.room})}}};var j=function(){var e=this,t=e._self._c;return t("li",{class:["room-item"],on:{click:e.onClickRoomItem}},[t("div",{staticClass:"item-thumb"},[t("user-avatar",{attrs:{user:e.computedAvatar,size:40}})],1),t("div",{staticClass:"item-details"},[t("div",{staticClass:"title-row"},[t("h6",{staticClass:"item-title"},[e._v(e._s(e.roomName))]),e.showLastMessage&&e.room.lastConversationAt?t("small",{staticClass:"item-meta"},[e._v(e._s(e._f("momentCalendarTz")(e.room.lastConversationAt)))]):e._e()]),e.showLastMessage&&e.room.lastConversationAt?[e.room.message?t("div",{staticClass:"meta-row text-ellipsis"},[e.room.message==="%%chat_attachment_%%"?t("span",[e._v(e._s(e.$t("upload.attachment")))]):t("span",[e._v(e._s(e.removeHtmlTags(e.room.message)))])]):e.room.isGroup?t("div",{staticClass:"meta-row text-ellipsis"},[t("span",[e._v(e._s(e.room.memberCount)+" "+e._s(e.$t("chat.members")))])]):e._e()]:e._e(),e.room.unreadMessages?t("div",{staticClass:"unread-messages"},[t("span",{staticClass:"badge badge-sm badge-pill badge-light"},[e._v(e._s(e.room.unreadMessages))])]):e._e()],2),e._t("actions",function(){return[e.showCustomAction?t("div",{staticClass:"item-actions action-buttons floating-action-buttons"},[t("button",{attrs:{type:"button"},on:{click:function(a){return a.stopPropagation(),e.doCustomAction.apply(null,arguments)}}},[t("i",{class:e.customActionIcon})])]):e._e()]})],2)},N=[],q=c(P,j,N,!1,null,null,null,null);const H=q.exports,z={props:{room:{type:Object,required:!0},roomName:{type:String,required:!0},vars:{type:Object,required:!0},configs:{type:Object,required:!0},typingUser:{type:String},canModerate:{type:Boolean,default:!1}},data(){return{subscriptions:{},callId:null}},computed:{...n("user",["loggedInUser","loggedInUserBusy","liveUsers","hasPermission"]),computedUser(){return this.room.isGroup||!this.room.member?this.room:this.room.member},liveUser(){return this.computedUser&&this.liveUsers.find(s=>s.uuid===this.computedUser.uuid)},isOnline(){return!!this.liveUser},isUserBusy(){return this.isOnline&&!!this.liveUser.busy},callUuid(){return this.callId?this.callId:this.callId=uuid()},toUser(){return{uuid:this.computedUser.uuid,username:this.computedUser.username,profile:this.computedUser.profile}},fromUser(){return{uuid:this.loggedInUser.uuid,username:this.loggedInUser.username,profile:this.loggedInUser.profile}},roomMembers(){return this.room.memberCount<=1?this.$t("chat.only_you_are_member"):this.room.members&&this.room.members.length>1?this.room.members[1].user.profile.name+this.$t("chat.and_n_other_members",{attribute:this.room.memberCount-1}):""},canSeeInfo(){return this.room.isGroup&&!this.room.hasLeft&&this.configs&&this.configs.chat.groupChat},canCall(){return!this.room.isGroup&&this.isOnline&&!this.isUserBusy&&!this.loggedInUserBusy&&this.hasPermission("create-meeting")}},methods:{...l("user",["UpdateLiveUser"]),goToGroup(){this.$emit("goToGroup",this.room)},setUserStatus(s=!1,e=null){this.UpdateLiveUser({...this.fromUser,busy:s,timerToFalse:e}),this.subscriptions.users.whisper("SetUserStatus",{...this.fromUser,busy:s})},showCallingNotification(s){window.callPlaying=C();const e={title:$t("chat.calling",{attribute:s.profile.name}),cancelButtonText:$t("chat.cancel"),showConfirmButton:!1,showCancelButton:!0,position:this.$toastConfig&&this.$toastConfig.position?this.$toastConfig.position.replace("-center","").replace("start","left").replace("end","right"):"bottom-end"};this.$toasted.clear(),this.setUserStatus("CALLING"),window.callTo=s,b.fire(e).then(t=>{window.callPlaying.pause(),window.callTo=null,t.value?this.setUserStatus("ON_CALL"):t.dismiss===u.DismissReason.cancel?(this.setUserStatus(!1),this.subscriptions.users.whisper("CallCancelled",{to:this.toUser,from:this.fromUser,id:this.callUuid}),this.$toasted.info($t("chat.call_cancelled"),this.$toastConfig.info)):t.dismiss===u.DismissReason.timer&&(this.setUserStatus(!1),this.$toasted.info($t("chat.call_not_answered",{attribute:s.profile.name}),this.$toastConfig.info))})},startCalling(){this.$gaEvent("engagement","startCalling","ProfileButtons"),this.$emit("buttonClicked"),this.showCallingNotification(this.toUser),this.callId=uuid(),window.callUuid=this.callUuid,this.subscriptions.users.whisper("IncomingCall",{to:this.toUser,from:this.fromUser,id:this.callUuid})},endCall(){this.subscriptions.users.whisper("EndCalling",{to:this.toUser,from:this.fromUser,id:this.callUuid}),this.setUserStatus(!1),window.callUuid=null},clearRoom(){this.$emit("clearRoom",this.room)},deleteRoom(){this.$emit("deleteRoom",this.room)}},created(){window.Echo&&window.EchoOpts&&(this.subscriptions={users:window.EchoOpts.subscriptions.users})}};var W=function(){var e=this,t=e._self._c;return t("div",{staticClass:"conversation-header"},[t("div",{staticClass:"room-thumb"},[t("user-avatar",{attrs:{user:e.computedUser,size:40}})],1),t("div",{staticClass:"room-details"},[t("div",{staticClass:"title-row"},[t("h6",{staticClass:"room-title"},[e._v(e._s(e.roomName))])]),t("div",{staticClass:"meta-row"},[!e.room.isGroup&&!e.typingUser?[e.isOnline?t("span",[e._v(e._s(e.$t("general.online")))]):t("span",[e._v(e._s(e.$t("general.offline")))])]:e.room.isGroup?[e.typingUser?[t("span",{staticClass:"typing-indicator"},[e._v(e._s(e.typingUser)+" "+e._s(e.$t("general.is_typing")))]),e._v(" "),t("span",[e._v(" \xA0")])]:e.roomMembers?t("span",[e._v(e._s(e.roomMembers))]):t("span",[e._v(e._s(e.room.memberCount)+" "+e._s(e.$t("chat.members")))])]:[t("span",{directives:[{name:"show",rawName:"v-show",value:e.typingUser,expression:"typingUser"}],staticClass:"typing-indicator"},[e._v(e._s(e.$t("general.is_typing")))]),e._v(" "),t("span",[e._v(" \xA0")])]],2)]),t("div",{staticClass:"room-btns action-buttons"},[e.canSeeInfo||e.canCall||e.canModerate?t("base-dropdown",{attrs:{tag:"div",direction:"down","menu-classes":"show-dropdown-down",position:"right"}},[t("button",{attrs:{slot:"title",type:"button","data-toggle":"dropdown",role:"button"},slot:"title"},[t("i",{staticClass:"fas fa-ellipsis-vertical"})]),e.canSeeInfo?t("a",{staticClass:"dropdown-item",on:{click:e.goToGroup}},[t("i",{staticClass:"fas fa-info-circle"}),e._v(" "+e._s(e.$t("chat.more_info"))+" ")]):e._e(),e.canCall?t("a",{staticClass:"dropdown-item",on:{click:e.startCalling}},[t("i",{staticClass:"fas fa-phone-alt"}),e._v(" "+e._s(e.$t("chat.start_calling"))+" ")]):e._e(),!e.room.isGroup||e.canModerate?t("a",{staticClass:"dropdown-item",on:{click:e.clearRoom}},[t("i",{staticClass:"fas fa-eraser"}),e._v(" "+e._s(e.$t("chat.clear_chat"))+" ")]):e._e(),(!e.room.isGroup||e.canModerate)&&!e.room.meetingUuid?t("a",{staticClass:"dropdown-item",on:{click:e.deleteRoom}},[t("i",{staticClass:"fas fa-trash-can"}),e._v(" "+e._s(e.$t("global.delete",{attribute:e.$t("chat.chat")}))+" ")]):e._e()]):e._e()],1)])},K=[],J=c(z,W,K,!1,null,null,null,null);const Q=J.exports,X={props:{message:{type:Object,required:!0},fileIcons:{type:Object,required:!0},fileMimeTypes:{type:Object,required:!0},vars:{type:Object,default(){return{}}}},data(){return{messageStatusIcons:{sending:"far fa-clock",sent:"fas fa-check",delivered:"fas fa-check-double",read:"fas fa-check-double",error:"fas fa-exclamation-triangle"}}},computed:{hasAttachment(){return(!this.message.message||this.message.message==="%%chat_attachment_%%")&&this.message.attachments&&this.message.attachments.length}},methods:{removeHtmlTags(s){if(!s)return s;s=s.replace(/<[^>]+/gmi,t=>t.replace(/ on\w+="[^"]*"/gmi,"")).replace(/<(?!\/?>)[^>]+>/gmi," ").replace(/\s+/gmi," ");let e=document.createElement("DIV");return e.innerHTML=s,e.textContent||e.innerText||""}}};var Y=function(){var e=this,t=e._self._c;return t("div",{staticClass:"message-item-wrapper"},[t("div",{class:["message-item",{"has-attachments":e.hasAttachment}]},[t("span",{staticClass:"tail-in"},[t("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 13",width:"8",height:"13"}},[t("path",{attrs:{opacity:".13",fill:"#0000000",d:"M1.533 3.568L8 12.193V1H2.812C1.042 1 .474 2.156 1.533 3.568z"}}),t("path",{attrs:{fill:"currentColor",d:"M1.533 2.568L8 11.193V0H2.812C1.042 0 .474 1.156 1.533 2.568z"}})])]),t("div",{staticClass:"message-header"},[t("h6",{staticClass:"message-user"},[e._v(e._s(e.message.user.profile.name))])]),e.hasAttachment?t("div",{staticClass:"message-content"},[e._l(e.message.attachments,function(a){return[t("div",{key:a.uuid,class:["attachment",{"non-image-attachment":a.mime!=="image/png"&&a.mime!=="image/jpeg"}]},[a.mime==="image/png"||a.mime==="image/jpeg"?[t("a",{staticClass:"attachment-link",attrs:{href:a.fullUrl,target:"_blank"}},[t("img",{staticClass:"img-fluid",attrs:{src:a.fullUrl,alt:a.filename}})]),t("div",{staticClass:"attachment-shadow"}),t("div",{staticClass:"message-footer small"},[e.message.sentAt?t("span",{staticClass:"message-created-at"},[e._v(e._s(e._f("momentCalendarTz")(e.message.sentAt)))]):e._e(),t("span",{class:["message-status",e.message.status]},[t("i",{class:e.messageStatusIcons[e.message.status]})])])]:[t("a",{staticClass:"attachment-link",attrs:{href:a.fullUrl,target:"_blank"}},[t("div",{staticClass:"attachment-details"},[t("div",{staticClass:"attachment-icon"},[t("i",{class:["fas",e.fileIcons[a.mime]]})]),t("div",{staticClass:"attachment-name"},[t("h6",[e._v(e._s(a.filename))])]),e._m(0,!0)])]),t("div",{staticClass:"message-footer small"},[t("div",{staticClass:"left-side"},[t("span",{staticClass:"attachment-type"},[e._v(e._s(e.fileMimeTypes[a.mime]))]),t("span",{staticClass:"attachment-size"},[e._v(e._s(a.humanReadableSize))])]),t("div",{staticClass:"right-side"},[e.message.sentAt?t("span",{staticClass:"message-created-at"},[e._v(e._s(e._f("momentCalendarTz")(e.message.sentAt)))]):e._e(),t("span",{class:["message-status",e.message.status]},[t("i",{class:e.messageStatusIcons[e.message.status]})])])])]],2)]})],2):t("div",{staticClass:"message-content"},[t("div",{staticClass:"message-body"},[e.message.status==="sent"?t("div",{staticClass:"message",domProps:{innerHTML:e._s(e.message.message)}}):t("div",{staticClass:"message"},[e._v(e._s(e.removeHtmlTags(e.message.message)))]),t("div",{staticClass:"footer-space"})]),t("div",{staticClass:"message-footer small"},[e.message.sentAt?t("span",{staticClass:"message-created-at"},[e._v(e._s(e._f("momentCalendarTz")(e.message.sentAt)))]):e._e(),t("span",{class:["message-status",e.message.status]},[t("i",{class:e.messageStatusIcons[e.message.status]})])])])])])},Z=[function(){var s=this,e=s._self._c;return e("div",{staticClass:"download-icon"},[e("i",{staticClass:"far fa-arrow-alt-circle-down"})])}],V=c(X,Y,Z,!1,null,null,null,null);const ee=V.exports;const te={name:"ChatBox",components:{FileUploader:g,EmojiPicker:p,ChatBoxHeader:x,ChatBoxSettings:E,ChatBoxGroup:I,ChatRoomItem:H,ConversationHeader:Q,MessageItem:ee},props:{channel:{default:null},boxVisibility:{type:Boolean,default:!1},fullPage:{type:Boolean,default:!1},restrict:{type:Boolean,default:!1},restrictTo:{type:String,default:null},meeting:{type:Object,default(){return{}}}},data(){return{isBoxShown:!1,isSearchShown:!1,showChatOptions:!1,largeChatBox:!1,searched:!1,newChatScreen:!1,newGroupScreen:!1,cbHeaderTitle:$t("chat.live_chat"),searchTerm:"",searchTermEmoji:"",activeContainer:"home",members:[],newMessage:{message:"",attachments:[],updated:!1},newMessageRequestUUID:uuid(),activeConversation:null,activeGroup:null,activeGroupMembersToAdd:[],activeGroupMembersToRemove:[],uploadURL:"",formErrors:{},preRequisite:{uploaderConfig:{module:"",token:"",allowedExtensions:"",allowedMaxFileSize:null,maxNoOfFiles:1,uuid:uuid()}},goingToConversation:!1,isFetching:!1,noMoreMessages:!1,newUnreadMessageOnFeed:!1,showScrollToLatestBtn:!1,chatRoomChannel:null,typingUser:null,typingUserTimeout:null,initialNewMessage:null,firstFetch:!0,fileIcons:w,fileMimeTypes:T}},watch:{boxVisibility(s,e){this.isBoxShown=s,this.isBoxShown&&document.body.classList.add("chat-box-shown")},activeChatUser(s,e){s!==null&&(!e||e!==null&&s.uuid!==e.uuid)&&this.goToConversation({user:s})},activeChatRoom(s,e){this.goingToConversation===!1&&s!==null&&(!e||e!==null&&s.uuid!==e.uuid)&&this.goToConversation({room:s})}},computed:{...n("config",["vars","configs","uiConfigs"]),...n("user",{userUuid:"uuid"}),...n("user",["profile","username"]),...n("chat",["rooms","roomsPageMeta","roomsSearch","messages","messagesPageMeta","messagesSearch","activeChatRoom","activeChatUser"]),user(){return{uuid:this.userUuid,username:this.username,name:this.profile.name,profile:this.profile}},hasMessages(){return this.activeConversation&&this.messages.data},computedParticipants(){return this.activeConversation?this.activeConversation.members:[]},enterToSubmit(){return this.configs.chat&&this.configs.chat.enterToSubmit}},methods:{...l("chat",["GetRooms","GetRoom","AddMemberToRoom","RemoveMemberFromRoom","SearchRooms","SearchMessages","GetMessages","SendMessage","PutMessageToFeed","PatchMessageInFeed","ResetMessage","SetMessage","ClearRoom","DeleteRoom","ResetTotalUnreadCount","SetActiveChatRoom","SetActiveChatUser","ResetActiveChatRoomAndUser","SearchRoomMembers"]),hideChatBox(){this.isBoxShown=!1,this.ResetActiveChatRoomAndUser(),setTimeout(()=>{this.$emit("boxHidden")},200)},showChatBox(){this.isBoxShown=!0,this.$emit("boxShown")},hideSearch(){this.searchTerm="",this.searched=!1,this.isSearchShown=!1,this.showChatOptions=!0,this.newChatScreen=!1,this.newGroupScreen=!1,this.activeContainer==="home"?(this.fetchRooms(!0),this.scrollTo("vue-scroll-rooms",0)):this.activeContainer==="conversation"&&this.fetchMessages(!0)},toggleSearch(s=!1,e=!1){this.searchTerm="",this.searched=!1,this.isSearchShown=!this.isSearchShown,this.isSearchShown?(this.newChatScreen=s,this.newGroupScreen=e,this.showChatOptions=!(s||e),this.$nextTick(()=>{this.$refs.searchTerm.focus()})):(this.newChatScreen=!1,this.newGroupScreen=!1,this.showChatOptions=!0,this.activeContainer==="home"?(this.fetchRooms(!0),this.scrollTo("vue-scroll-rooms",0)):this.activeContainer==="conversation"&&this.fetchMessages(!0))},startNewChat(){this.toggleSearch(!0)},goHome(){if(this.restrict){this.restrictToRoom();return}this.lastActiveContainer=this.activeContainer,this.activeContainer="home",this.ResetActiveChatRoomAndUser(),this.lastActiveContainer==="conversation"?(this.leaveChatRoomChannel(this.activeConversation.chatRoom),this.hideSearch(),this.searchRoomObj&&this.searchRoomObj.searched?(this.searchTerm=this.searchRoomObj.searchTerm,this.searched=this.searchRoomObj.searched,this.isSearchShown=!0,this.showChatOptions=!1):this.fetchRooms()):this.fetchRooms(),this.scrollTo("vue-scroll-rooms",0),setTimeout(()=>{this.activeConversation=null},100)},goToConversation({room:s,user:e},t=!1){this.goingToConversation=!0;const a=()=>{setTimeout(()=>{this.activeContainer="conversation",this.isSearchShown?(this.searchRoomObj={searchTerm:this.searchTerm,searched:this.searched},this.hideSearch()):this.searchRoomObj={searchTerm:null,searched:null},this.goingToConversation=!1,window.setTimeout(()=>{this.scrollToLatestMessages(),this.focusNewMessage(),this.showScrollToLatestBtn=!1,this.newUnreadMessageOnFeed=!1},300)},100)};this.activeConversation={chatRoom:s||null,user:s&&s.isGroup?null:e||null,members:s&&s.isGroup?s.members:e?[e]:[]},this.ResetMessage(),s?(s.hasLeft||this.joinChatRoomChannel(s),this.GetRoom({uuid:s.uuid}).then(i=>{const o=i.chatRoom,r=i.chats;this.activeConversation.chatRoom=o,s.hasLeft&&!o.hasLeft&&this.joinChatRoomChannel(o),o.hasLeft&&this.leaveChatRoomChannel(o),this.SetMessage({data:[...r],meta:{...this.messages.meta,total:r.length,lastItemUuid:r.length?r[r.length-1].uuid:null}}),this.activeConversation.chatRoom&&this.activeConversation.chatRoom.hasOwnProperty("chats")&&delete this.activeConversation.chatRoom.chats,this.noMoreMessages=!1,this.SetActiveChatRoom(this.activeConversation.chatRoom),a()}).catch(i=>{this.goingToConversation=!1,formUtil.handleErrors(i)})):(this.SetActiveChatUser(this.activeConversation.user),this.fetchMessages(!0),a())},goToSettings(){this.lastActiveContainer=this.activeContainer,this.activeContainer="settings",this.scrollTo("vue-scroll-rooms",0),setTimeout(()=>{this.lastActiveContainer==="conversation"&&(this.ResetActiveChatRoomAndUser(),this.leaveChatRoomChannel(this.activeConversation.chatRoom)),this.isSearchShown&&this.hideSearch(),this.activeConversation=null},100)},goToCreateGroup(){this.activeGroup=null,this.goToGroup()},goToGroup(s=null){this.activeGroupMembersToAdd=[],this.activeGroupMembersToRemove=[],this.lastActiveContainer=this.activeContainer,this.activeContainer="chatgroup",this.activeGroup=s,this.scrollTo("vue-scroll-rooms",0),this.isSearchShown&&this.hideSearch(),s||this.$nextTick(()=>{window.setTimeout(()=>{this.$refs.chatBoxGroup.$refs.groupName.focus()},300)})},showAddMemberScreen(){this.activeGroupMembersToAdd=[],this.activeGroupMembersToRemove=[],this.toggleSearch(!1,!0)},addToGroup(s){s&&s.user&&(this.activeGroup?(this.isLoading=!0,this.AddMemberToRoom({uuid:this.activeGroup.uuid,members:[s.user]}).then(e=>{this.isLoading=!1,this.activeGroup=e,this.activeConversation.chatRoom=e,this.activeConversation.chatRoom.members=e.members}).catch(e=>{this.isLoading=!1,formUtil.handleErrors(e)})):this.activeGroupMembersToAdd.push(s)),this.toggleSearch()},removeMemberFromGroup(s){this.activeGroupMembersToAdd=[],this.activeGroupMembersToRemove=[],s&&s.user&&(this.activeGroup?(this.isLoading=!0,this.RemoveMemberFromRoom({uuid:this.activeGroup.uuid,members:[s.user]}).then(e=>{this.isLoading=!1,this.activeGroup=e,this.activeConversation.chatRoom=e}).catch(e=>{this.isLoading=!1,formUtil.handleErrors(e)})):this.activeGroupMembersToRemove.push(s))},goBack(){this.lastActiveContainer?this.activeContainer=this.lastActiveContainer:this.goHome()},searchTermChanged:_.debounce(function(){!this.searchTerm||this.searchTerm.length<2||(this.activeContainer==="home"||this.activeContainer==="chatgroup"?(this.searchRooms(),this.scrollTo("vue-scroll-rooms",0)):this.activeContainer==="conversation"&&this.searchMessages())},500),handleAt(s){if(!s||s.length<2){this.activeConversation&&(this.activeConversation.members=[]);return}if(!this.activeConversation.chatRoom){this.activeConversation.members=[];return}this.SearchRoomMembers({uuid:this.activeConversation.chatRoom.uuid,term:s}).then(e=>{this.activeConversation.members=e}).catch(e=>{formUtil.handleErrors(e),this.activeConversation&&(this.activeConversation.members=[])})},fetchRooms(s=!0,e){this.isFetching=!0;const t={...this.roomsPageMeta,meetingUuid:this.restrictTo,lastItemUuid:s?null:this.rooms.meta.lastItemUuid,perPage:this.rooms.meta.perPage};this.GetRooms(t).then(a=>{this.isFetching=!1,e&&e()}).catch(a=>{this.isFetching=!1,formUtil.handleErrors(a)})},searchRooms(){this.isFetching=!0,this.SearchRooms({term:this.searchTerm,meetingUuid:this.restrictTo}).then(s=>{this.searched=!0,this.showChatOptions=!1,this.isFetching=!1}).catch(s=>{this.isFetching=!1,formUtil.handleErrors(s)})},searchMessages(){!this.activeConversation.chatRoom||(this.isFetching=!0,this.SearchMessages({q:this.searchTerm,chatRoom:this.activeConversation.chatRoom.uuid}).then(s=>{this.searched=!0,this.isFetching=!1,window.setTimeout(()=>{this.scrollToLatestMessages(),this.showScrollToLatestBtn=!1,this.newUnreadMessageOnFeed=!1},300)}).catch(s=>{this.isFetching=!1,formUtil.handleErrors(s)}))},fetchMessages(s=!1){if(!this.activeConversation||!this.activeConversation.chatRoom&&!this.activeConversation.user)return;this.isFetching=!0,this.noMoreMessages=!1,this.newUnreadMessageOnFeed=!1;const e={...this.messagesPageMeta,lastItemUuid:s?null:this.messages.meta.lastItemUuid,perPage:this.messages.meta.perPage,chatRoom:this.activeConversation.chatRoom?this.activeConversation.chatRoom.uuid:null,user:this.activeConversation.user?this.activeConversation.user.uuid:null};this.GetMessages(e).then(t=>{this.isFetching=!1,t.data.length||(this.noMoreMessages=!0),s&&window.setTimeout(()=>{this.scrollToLatestMessages(),this.showScrollToLatestBtn=!1,this.newUnreadMessageOnFeed=!1},300),this.searched||this.focusNewMessage()}).catch(t=>{this.isFetching=!1,formUtil.handleErrors(t)})},chatRoomUpdated(){this.GetRoom({uuid:this.activeConversation.chatRoom.uuid}).then(s=>{const e=s.chatRoom;this.activeConversation.chatRoom=e,s.hasLeft&&this.leaveChatRoomChannel(e)}).catch(s=>{formUtil.handleErrors(s)})},postMessage(){if(!this.newMessage.message)return;this.newMessage.message=this.removeHtmlTags(this.newMessage.message.trim());const s={uuid:this.newMessageRequestUUID,message:this.newMessage.message,user:this.user,sentAt:f(this.vars.serverDateTimeFormat),status:"sending"};this.newMessageRequestUUID=uuid(),this.newMessage=_.cloneDeep(this.initialNewMessage),this.noMoreMessages=!1,this.putMessageToFeed(s),window.setTimeout(()=>{this.scrollTo("vue-scroll-messages",100),this.focusNewMessage()},300),this.SendMessage({message:s.message,chatRoom:this.activeConversation.chatRoom,user:this.activeConversation.user}).then(e=>{this.messageSentSuccess(s,e)}).catch(e=>{this.messageSendingFailed(s,e)})},attachmentUploadStarted(s){if(!this.newMessage.attachments||this.newMessage.attachments.length)return;const e={uuid:this.newMessageRequestUUID,message:null,user:this.user,sentAt:moment.utc().format(this.vars.serverDateTimeFormat),status:"sending"};this.newMessageRequestUUID=uuid(),this.newMessage=_.cloneDeep(this.initialNewMessage),this.putMessageToFeed(e),window.setTimeout(()=>{this.scrollTo("vue-scroll-messages",100),this.focusNewMessage()},300)},attachmentUploaded(s){if(!(s&&s.meta&&s.meta.requestUuid)){this.$toasted.error($t("misc.error_unknown"),this.$toastConfig.error);return}d.$emit("RESET_UPLOAD"),this.messageSentSuccess({uuid:s.meta.requestUuid},s)},attachmentUploadError(s){if(!(s&&s.meta&&s.meta.requestUuid)){this.$toasted.error($t("misc.error_unknown"),this.$toastConfig.error);return}d.$emit("RESET_UPLOAD"),s&&this.messageSendingFailed({uuid:s.meta.requestUuid},s)},messageSentSuccess(s,e){const t=e.data;this.PatchMessageInFeed({old:s,new:{...t,newUuid:t.uuid,uuid:s.uuid}}),this.activeConversation.chatRoom||(this.joinChatRoomChannel(t.chatRoom),this.GetRoom({uuid:t.chatRoom.uuid}).then(a=>{this.activeConversation.chatRoom=a.chatRoom,this.activeConversation.chatRoom&&this.activeConversation.chatRoom.hasOwnProperty("chats")&&delete this.activeConversation.chatRoom.chats}).catch(a=>{formUtil.handleErrors(a)}))},messageSendingFailed(s,e){this.PatchMessageInFeed({old:s,new:{...s,status:"error",error:formUtil.getError(e)}})},noNeedCallback(){this.afterUploadComplete()},joinChatRoomChannel(s){window.EchoOpts.subscriptions.chatRoom=window.Echo.join(`ChatRoom.${s.uuid}`),this.chatRoomChannel=window.EchoOpts.subscriptions.chatRoom,this.chatRoomChannel.listen("ChatMessageSentToRoom",this.newMessageReceived),this.chatRoomChannel.listen("ChatRoomUpdated",this.chatRoomUpdated),this.chatRoomChannel.listenForWhisper("typing",this.anotherUserTyping)},leaveChatRoomChannel(s){this.chatRoomChannel&&(this.chatRoomChannel.stopListening("ChatMessageSentToRoom"),this.chatRoomChannel=null),s&&window.Echo.leave(`ChatRoom.${s.uuid}`),window.EchoOpts&&window.EchoOpts.subscriptions&&(window.EchoOpts.subscriptions.chatRoom=null)},clearRoom(s){s&&(this.isLoading=!0,this.ClearRoom(s).then(e=>{this.goHome(),this.isLoading=!1}).catch(e=>{this.isLoading=!1,formUtil.handleErrors(e)}))},deleteRoom(s){s&&(this.isLoading=!0,this.DeleteRoom(s).then(e=>{this.goHome(),this.isLoading=!1}).catch(e=>{this.isLoading=!1,formUtil.handleErrors(e)}))},enterPressedEvt(s,e){return this.enterToSubmit?R(s,e):!1},putMessageToFeed(s){this.messages.data.findIndex(e=>e.uuid===s.uuid)===-1&&this.PutMessageToFeed(s)},focusNewMessage(){this.$refs.newMessageInput&&this.$refs.newMessageInput.focus()},scrollTo(s,e){this.$refs[s]&&this.$refs[s].scrollTo({y:`${e}%`},300)},scrollToLatestMessages(){this.scrollTo("vue-scroll-messages",100)},handleMessageScroll:_.debounce(function(s,e){s.process>.95?(this.showScrollToLatestBtn=!1,this.newUnreadMessageOnFeed=!1):(!this.searched||this.searched&&s.process!==0)&&(this.showScrollToLatestBtn=!0),s.process<.5&&!this.isFetching&&!this.noMoreMessages&&this.fetchMessages()},500),handleRoomsScroll:_.debounce(function(s,e){s.process>.5&&!this.isFetching&&this.fetchRooms()},500),isTyping:_.throttle(function(){this.chatRoomChannel&&this.chatRoomChannel.whisper("typing",{user:this.user})},500,{leading:!0,trailing:!1}),anotherUserTyping({user:s}){this.typingUser=s.name,this.typingUserTimeout&&clearTimeout(this.typingUserTimeout),this.typingUserTimeout=setTimeout(()=>{this.typingUser=null},1500)},newMessageReceived(s){!s||(s=y(s),s&&s.user&&s.user.uuid!==this.userUuid&&(this.putMessageToFeed(s),window.setTimeout(()=>{const{v:e,h:t}=this.$refs["vue-scroll-messages"].getScrollProcess();e>.5?this.scrollToLatestMessages():(this.showScrollToLatestBtn=!0,this.newUnreadMessageOnFeed=!0)},300)))},appendEmoji(s){this.newMessage.message+=s},removeHtmlTags(s){return s=s&&s.replace(/<[^>]+/gmi,e=>e.replace(/ on\w+="[^"]*"/gmi,"")).replace(/<(?!\/?b>|\/?p>|\/?strong>|\/?div>|\/?br>|\/?span>|\/?em>|\/?i>)[^>]+>/gmi,""),s},doInit(){this.initialNewMessage=_.cloneDeep(this.newMessage),this.activeChatRoom?this.goToConversation({room:this.activeChatRoom}):this.activeChatUser?this.goToConversation({user:this.activeChatUser}):this.fetchRooms(!0,()=>{this.restrict&&this.restrictToRoom()}),this.isBoxShown&&document.body.classList.add("chat-box-shown"),setTimeout(()=>{this.showChatOptions=this.boxVisibility},1e3)},restrictToRoom(){let s=null;const e=this.rooms&&this.rooms.data&&this.rooms.data?this.rooms.data:[];this.restrictTo?(_.isObject(this.restrictTo)?s=this.restrictTo:e.length&&(s=e.find(t=>t.meetingUuid===this.restrictTo)),s&&this.goToConversation({room:s})):e.length&&(s=e[0],this.goToConversation({room:s}))}},directives:{focus:{inserted(s){s.focus()}}},mounted(){setTimeout(()=>{this.isBoxShown=this.boxVisibility},100),setTimeout(()=>{this.doInit()},200)},created(){this.configs.system&&this.configs.system.allowedFileExtensions&&(this.preRequisite.uploaderConfig.allowedExtensions=this.configs.system.allowedFileExtensions),this.configs.system&&this.configs.system.postMaxSize&&(this.preRequisite.uploaderConfig.allowedMaxFileSize=this.configs.system.postMaxSize)},beforeDestroy(){document.body.classList.remove("chat-box-shown"),window.Echo&&window.EchoOpts&&window.EchoOpts.subscriptions&&window.EchoOpts.subscriptions.chatRoom&&(window.EchoOpts.subscriptions.chatRoom.stopListening("ChatMessageSentToRoom"),window.EchoOpts.subscriptions.chatRoom=null)}};var se=function(){var e=this,t=e._self._c;return t("div",{class:["chat-box-wrapper",{shown:e.isBoxShown},{"search-shown":e.isSearchShown},{"chat-box-lg":e.largeChatBox},{"show-chat-options":e.showChatOptions}]},[t("chat-box-header",{attrs:{"active-container":e.activeContainer,configs:e.configs,"full-page":e.fullPage,restrict:e.restrict},on:{goHome:e.goHome,toggleSearch:e.toggleSearch,goToSettings:e.goToSettings,goBack:e.goBack,hideChatBox:e.hideChatBox,showAddMemberScreen:e.showAddMemberScreen}}),t("div",{staticClass:"search"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTerm,expression:"searchTerm"}],ref:"searchTerm",staticClass:"form-control",attrs:{type:"text",placeholder:e.$t("general.search_helper_default_text")},domProps:{value:e.searchTerm},on:{keydown:function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"esc",27,a.key,["Esc","Escape"])?null:e.toggleSearch.apply(null,arguments)},input:[function(a){a.target.composing||(e.searchTerm=a.target.value)},e.searchTermChanged]}}),e.searchTerm?t("button",{staticClass:"clear-btn",attrs:{type:"button"},on:{click:e.hideSearch}},[e._v(e._s(e.$t("general.clear")))]):e._e()]),t("div",{class:["chat-box",{"showing-settings":e.activeContainer==="settings"},{"showing-chats":e.activeContainer==="conversation"},{"showing-chatgroup":e.activeContainer==="chatgroup"}]},[e.configs.chat.groupChat?t("chat-box-group",{ref:"chatBoxGroup",attrs:{"active-container":e.activeContainer,"active-group":e.activeGroup,"members-to-add":e.activeGroupMembersToAdd,"members-to-remove":e.activeGroupMembersToRemove},on:{goToConversation:e.goToConversation,goBack:e.goBack,goHome:e.goHome},scopedSlots:e._u([{key:"members",fn:function({members:a}){return[t("div",{staticClass:"rooms-wrapper"},[e.searchTerm&&e.searched?[e.roomsSearch.rooms.length||e.roomsSearch.users.length?t("ul",{staticClass:"rooms"},[e._l(e.roomsSearch.rooms,function(i){return[i.isGroup?e._e():t("chat-room-item",{key:i.uuid,attrs:{room:i,"room-name":i.name,"click-action":"addToGroup",vars:e.vars,"show-last-message":!1},on:{addToGroup:e.addToGroup}})]}),e._l(e.roomsSearch.users,function(i){return t("chat-room-item",{key:i.uuid,attrs:{room:i,"room-name":i.profile.name,"click-action":"addToGroup",vars:e.vars},on:{addToGroup:e.addToGroup}})})],2):t("div",{staticClass:"no-data"},[t("h5",[e._v(e._s(e.$t("chat.no_result_found")))])])]:[t("ul",{staticClass:"rooms"},e._l(a,function(i){return t("chat-room-item",{key:i.user.uuid,attrs:{room:i.user,"room-name":i.user.profile.name,"click-action":"goToConversation","show-custom-action":e.activeGroup&&e.activeGroup.canModerate,"click-action-on-custom":"removeMember",vars:e.vars},on:{goToConversation:e.goToConversation,removeMember:e.removeMemberFromGroup}})}),1)]],2)]}}],null,!1,3462095424)}):e._e(),t("chat-box-settings",{attrs:{"active-container":e.activeContainer},on:{goHome:e.goHome}}),t("div",{staticClass:"cb-inner-window rooms-container"},[t("vue-scroll",{ref:"vue-scroll-rooms",attrs:{id:"vue-scroll-rooms"},on:{"handle-scroll":e.handleRoomsScroll}},[t("div",{staticClass:"rooms-wrapper"},[e.searchTerm&&e.searched||e.newChatScreen||e.newGroupScreen?[e.roomsSearch.rooms.length||e.roomsSearch.users.length?t("ul",{staticClass:"rooms"},[!e.newChatScreen||!e.newGroupScreen?[e._l(e.roomsSearch.rooms,function(a){return t("chat-room-item",{key:a.uuid,attrs:{room:a,"room-name":a.name,vars:e.vars},on:{goToConversation:e.goToConversation}})}),e.roomsSearch.users.length?t("li",{staticClass:"my-2 pl-3 font-weight-500"},[e._v(e._s(e.$t("user.users")))]):e._e()]:e._e(),e._l(e.roomsSearch.users,function(a){return t("chat-room-item",{key:a.uuid,attrs:{room:a,"room-name":a.profile.name,"click-action":"goToConversation",vars:e.vars},on:{goToConversation:e.goToConversation}})})],2):t("div",{staticClass:"no-data"},[t("h5",[e._v(e._s(e.$t("chat.no_result_found")))])])]:[e.rooms.data&&e.rooms.data.length?t("ul",{staticClass:"rooms"},e._l(e.rooms.data,function(a){return t("chat-room-item",{key:a.uuid,attrs:{room:a,"room-name":a.name,vars:e.vars},on:{goToConversation:e.goToConversation}})}),1):t("div",{staticClass:"no-data"},[t("h5",[e._v(e._s(e.$t("chat.no_chats_yet")))])])]],2)]),t("div",{staticClass:"chat-option-buttons"},[e.configs.chat.groupChat?t("button",{attrs:{type:"button"},on:{click:e.goToCreateGroup}},[t("i",{staticClass:"fas fa-users"})]):e._e(),t("button",{attrs:{type:"button"},on:{click:e.startNewChat}},[t("i",{staticClass:"fas fa-user"})]),e._m(0)])],1),t("div",{staticClass:"cb-inner-window conversation-container"},[e.activeConversation?t("div",{staticClass:"conversation-wrapper"},[e.activeConversation.chatRoom?t("conversation-header",{attrs:{room:e.activeConversation.chatRoom,"room-name":e.activeConversation.chatRoom.name,vars:e.vars,configs:e.configs,typingUser:e.typingUser,"can-moderate":e.activeConversation.chatRoom.canModerate},on:{goToGroup:e.goToGroup,clearRoom:e.clearRoom,deleteRoom:e.deleteRoom}}):e.activeConversation.user?t("conversation-header",{attrs:{room:e.activeConversation.user,"room-name":e.activeConversation.user.profile.name,vars:e.vars,configs:e.configs,typingUser:e.typingUser,"can-moderate":e.activeConversation.chatRoom&&e.activeConversation.chatRoom.canModerate},on:{clearRoom:e.clearRoom}}):e._e(),t("div",{class:["conversation",{"no-messages":!e.hasMessages},{"got-new-messages":e.newUnreadMessageOnFeed},{"show-scroll-btn":e.showScrollToLatestBtn}]},[e.hasMessages?t("div",{staticClass:"messages-list-container"},[t("vue-scroll",{ref:"vue-scroll-messages",attrs:{id:"vue-scroll-messages"},on:{"handle-scroll":e.handleMessageScroll}},[t("div",{class:["messages-list-wrapper",{"show-name":e.activeConversation.chatRoom&&e.activeConversation.chatRoom.isGroup}]},[e.searchTerm&&e.searched?[e.messagesSearch.length?e._l(e.messagesSearch,function(a,i){return t("message-item",{key:a.uuid,class:[{"own-message":a.user.uuid===e.userUuid},{"prev-diff-own":!e.messages.data[i+1]||e.messages.data[i+1].user.uuid!==a.user.uuid},{"next-diff-own":!e.messages.data[i-1]||e.messages.data[i-1].user.uuid!==a.user.uuid}],attrs:{message:a,vars:e.vars,"file-icons":e.fileIcons,"file-mime-types":e.fileMimeTypes}})}):t("div",{staticClass:"no-data"},[t("h5",[e._v(e._s(e.$t("chat.no_result_found")))])])]:[e._l(e.messages.data,function(a,i){return t("message-item",{key:a.uuid,class:[{"own-message":a.user.uuid===e.userUuid},{"prev-diff-own":!e.messages.data[i+1]||e.messages.data[i+1].user.uuid!==a.user.uuid},{"next-diff-own":!e.messages.data[i-1]||e.messages.data[i-1].user.uuid!==a.user.uuid}],attrs:{message:a,vars:e.vars,"file-icons":e.fileIcons,"file-mime-types":e.fileMimeTypes}})}),e.isFetching?t("div",{staticClass:"d-flex justify-content-center my-2"},[t("animated-loader",{attrs:{"is-loading":e.isFetching,"loader-color":e.vars.colors.light,"overlay-color":"transparent",size:"inline","loader-size":"20px","loader-stroke":"3px"}})],1):e._e(),e.noMoreMessages?t("div",{staticClass:"message-item my-4 d-flex justify-content-center align-items-center"},[t("h5",{staticClass:"text-muted"},[e._v(" "+e._s(e.$t("chat.no_more_messages"))+" ")])]):e._e()]],2)])],1):t("div",{staticClass:"d-flex justify-content-center align-items-center min-height-300px"},[t("h5",{staticClass:"text-muted"},[e._v(" "+e._s(e.$t("chat.no_messages_yet"))+" ")])]),t("div",{staticClass:"scroll-latest-btn",on:{click:e.scrollToLatestMessages}},[e._m(1)])]),e.activeConversation.chatRoom&&!e.activeConversation.chatRoom.isGroup||!e.activeConversation.chatRoom&&e.activeConversation.user||e.activeConversation.chatRoom&&e.activeConversation.chatRoom.isGroup&&!e.activeConversation.chatRoom.hasLeft?t("div",{staticClass:"conversation-footer"},[t("div",{staticClass:"new-message"},[t("vue-at",{attrs:{members:e.computedParticipants,"name-key":"name"},on:{at:e.handleAt},scopedSlots:e._u([{key:"item",fn:function(a){return[t("span",{staticClass:"mentioned"},[e._v(e._s(a.item.name)+" "),t("span",{staticClass:"bracketed text-muted-md"},[e._v(e._s(a.item.username))])])]}},{key:"embeddedItem",fn:function(a){return[t("span",[t("span",{staticClass:"tag mentioned bg-white text-primary mx-1 px-2 py-1 rounded",attrs:{"data-uuid":a.current&&a.current.user?a.current.user.uuid:""}},[e._v(e._s(a.current.name))]),e._v(" "),t("span")])]}}],null,!1,1168386567),model:{value:e.newMessage.message,callback:function(a){e.$set(e.newMessage,"message",a)},expression:"newMessage.message"}},[t("div",{ref:"newMessageInput",staticClass:"new-message-input form-control",attrs:{contenteditable:"","data-placeholder":e.$t("chat.type_a_message"),placeholder:e.$t("chat.type_a_message")},on:{keydown:[e.isTyping,function(a){return!a.type.indexOf("key")&&e._k(a.keyCode,"enter",13,a.key,"Enter")?null:e.enterPressedEvt(e.postMessage,a)}]}},[t("div")])]),t("emoji-picker",{staticClass:"emoji-picker-wrapper",attrs:{search:e.searchTermEmoji},on:{emoji:e.appendEmoji},scopedSlots:e._u([{key:"emoji-invoker",fn:function({events:{click:a}}){return t("button",{staticClass:"btn-custom emoji-button",attrs:{type:"button"},on:{click:function(i){return i.stopPropagation(),a.apply(null,arguments)}}},[t("i",{staticClass:"far fa-grin"})])}},{key:"emoji-picker",fn:function({emojis:a,insert:i}){return t("div",{staticClass:"emoji-picker-container"},[t("div",{staticClass:"emoji-picker"},[t("div",{staticClass:"emoji-picker__search"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.searchTermEmoji,expression:"searchTermEmoji"},{name:"focus",rawName:"v-focus"}],attrs:{type:"text"},domProps:{value:e.searchTermEmoji},on:{input:function(o){o.target.composing||(e.searchTermEmoji=o.target.value)}}})]),t("div",e._l(a,function(o,r){return t("div",{key:r,staticClass:"mt-2"},[t("h5",[e._v(e._s(r))]),t("div",{staticClass:"emojis"},e._l(o,function(h,m){return t("span",{key:m,attrs:{title:m},on:{click:function(oe){return i(h)}}},[e._v(e._s(h))])}),0)])}),0)])])}}],null,!1,1808624436)}),!e.newMessage.message&&e.configs.chat.fileSharing?t("file-uploader",{attrs:{url:"/chat/messages","name-label":"upload.attachment","names-label":"upload.attachments","button-icon":"fas fa-paperclip","button-classes":"btn-sm","button-design":"custom","hide-button-label":"","hide-file-list":"",options:e.preRequisite.uploaderConfig,data:e.newMessage.attachments,"additional-form-data":e.activeConversation,"request-identifier":e.newMessageRequestUUID},on:{uploading:e.attachmentUploadStarted,updated:e.attachmentUploaded,error:e.attachmentUploadError,noNeed:e.noNeedCallback}}):e._e(),t("button",{staticClass:"btn-custom post-message-button",attrs:{type:"button",title:e.$t("general.submit")},on:{click:e.postMessage}},[t("i",{staticClass:"far fa-paper-plane"})])],1)]):e._e()],1):e._e()])],1)],1)},ae=[function(){var s=this,e=s._self._c;return e("button",{attrs:{type:"button"}},[e("i",{staticClass:"fas fa-comment-dots fa-flip-horizontal"})])},function(){var s=this,e=s._self._c;return e("div",{staticClass:"scroll-btn-wrapper"},[e("i",{staticClass:"fas fa-angle-double-down"})])}],ie=c(te,se,ae,!1,null,null,null,null);const ge=ie.exports;export{ge as C};
