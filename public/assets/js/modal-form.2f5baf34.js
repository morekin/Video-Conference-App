import{m as a,i as s}from"./vendor/vendor-core.3574f8d9.js";import{z as r}from"./app.a373aa59.js";const f={components:{},props:{pushToArr:{type:Boolean,default:!1}},data(){return{formData:{},formErrors:{},initialFormData:null,emptyFormData:null,entity:null,preRequisite:{},isLoading:!0,initUrl:"",dataType:null,dataTypeArr:null,propertyToMatch:null}},computed:{...a("config",["configs","vars"]),codePrefix(){return this.formData.codePrefix},formHasErrors(){let t=!1;return this.formErrors.objForEach(i=>{t=i!==""?!0:t}),t}},watch:{codePrefix:function(t){if(this.preRequisite.codes){const i=this.preRequisite.codes.find(o=>o.codePrefix===t),e=this.configs[this.dataType].codeDigit;i?this.formData.codeNumber=r(i.codeNumber+1,e):this.formData.codeNumber=r(1,e)}}},methods:{...s("common",["Init","Store","GetPreRequisite","Custom"]),...s("config",["SetUiConfig"]),submit(){if(formUtil.isUnchanged(this.initialFormData,this.formData))return this.$toasted.info(this.$t("general.nothing_changed"),this.$toastConfig.info),!1;this.isLoading=!0,this.Store(this.formData).then(t=>{this.$toasted.success(t.message,this.$toastConfig),this.initialFormData=_.cloneDeep(this.formData),t.hasOwnProperty(this.dataType)&&(this.entity=t[this.dataType]),this.close(!0),this.isLoading=!1}).catch(t=>{this.isLoading=!1,this.formErrors=Object.assign(this.formErrors,formUtil.handleErrors(t))})},fillPreRequisite(t){this.preRequisite.objForEach((i,e)=>{this.preRequisite[e]=t.hasOwnProperty(e)?t[e]:i}),this.isLoading=!1},async getInitialData(t){this.isLoading=!0;try{const i=await this.GetPreRequisite();return this.fillPreRequisite(i),this.configs[this.dataType]&&this.$nextTick(()=>{this.formData.codePrefix=this.configs[this.dataType].codePrefix}),t&&this.$nextTick(()=>{t()}),i}catch(i){throw this.isLoading=!1,this.formErrors=formUtil.handleErrors(i),i}},close(t){t===!0?this.$emit("close",Object.assign({},this.entity?this.entity:this.formData,{dataType:this.dataType,dataTypeArr:this.dataTypeArr,propertyToMatch:this.propertyToMatch,dontMatch:!!this.entity,push:this.pushToArr})):this.$emit("close"),this.SetUiConfig({modalSidebarShow:!1})},addTag(t){const i={name:t,slug:formUtil.generateSlug(t)};this.preRequisite.tags.push(i),this.formData.tags.push(i)}},mounted(){this.Init({url:this.initUrl}),this.initialFormData=_.cloneDeep(this.formData)},beforeDestroy(){delete this.formData,delete this.formErrors,delete this.preRequisite}};export{f};
