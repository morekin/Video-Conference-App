import{b as s,e as r,d as o,p as h,g as d,a as l}from"./header.43f859fb.js";import"./helpers/transformers.20070e00.js";import{m as n,i as u}from"./vendor/vendor-core.3574f8d9.js";import{E as a}from"./event-bus.6a5776a8.js";import{_ as p}from"./vendor/vendor-others.c8ba1624.js";const q={components:{},data(){return{uuid:null,subUuid:null,entity:null,preRequisite:{},formData:{},formErrors:{},editing:!1,isLoading:!1,initialFormData:null,getInitialDataCalled:!1,autoExport:null,initUrl:"",fallBackRoute:"appDashboard",headerButtons:null,headerLinks:null,uploaderConfig:{module:"",token:"",allowedExtensions:"",allowedMaxFileSize:null,maxNoOfFiles:5,uuid:uuid()}}},watch:{$route(i,t){t.params.uuid!==i.params.uuid&&(this.isLoading=!0,this.uuid=i.params.uuid,this.getInitialDataCalled&&this.getInitialData())}},computed:{...n("config",["vars","configs","allowExtraInput"]),...n("user",["hasPermission"])},methods:{...u("common",["Init","InitSub","Get","GetList","Destroy","SetMeta","SetFilters","Custom","GetPreRequisite","ResetFilters","Update","SetPageHeader"]),...u("config",["SetUiConfig","SetConfig"]),fillPreRequisite(i){this.preRequisite.objForEach((t,e)=>{this.preRequisite[e]=i.hasOwnProperty(e)?i[e]:t})},setEntityData(i){this.entityKey&&i.hasOwnProperty(this.entityKey)?this.entity=i[this.entityKey]:this.entity=i},setUploaderConfig(i){this.uploaderConfig.objForEach((t,e)=>{this.uploaderConfig[e]=i.hasOwnProperty(e)?i[e]:t})},async getPreRequisite(i){this.isLoading=!0;try{let t=await this.GetPreRequisite();return this.fillPreRequisite(t),p.isObject(t)&&t.hasOwnProperty("uploadConfig")&&this.setUploaderConfig(t.uploadConfig),typeof this.afterGetPreRequisite=="function"&&this.afterGetPreRequisite(),i&&this.$nextTick(()=>{i()}),this.isLoading=!1,t}catch(t){this.isLoading=!1,formUtil.handleErrors(t)}},async getInitialData(i){this.isLoading=!0,this.getInitialDataCalled=!0;try{let t=await this.Get({uuid:this.uuid});return this.setEntityData(t),this.pageTitleProperty&&(this.pageTitle=this.entity[this.pageTitleProperty]+" - "+this.$t(this.$route.meta.title)),this.subTitleProperty&&(this.subTitle=this.entity[this.subTitleProperty]),this.afterGetInitialData&&typeof this.afterGetInitialData=="function"&&this.afterGetInitialData(t),i&&this.$nextTick(()=>{i(t)}),this.autoExport&&setTimeout(()=>{this.$nextTick(()=>{(!this.formData||!this.formData.hasOwnProperty("loaded")||this.formData.loaded)&&this.export()})},2e3),this.isLoading=!1,t}catch(t){this.isLoading=!1,formUtil.handleErrors(t),this.$router.push({name:this.fallBackRoute})}},getHeaderOptions(){let i=[];this.routesRequired&&this.routesRequired.add&&(typeof this.permissionsRequired=="object"&&this.permissionsRequired!==null&&this.permissionsRequired.add?i.push(s(this.routesRequired.add,this.permissionsRequired.add)):this.permissionsRequired?i.push(s(this.routesRequired.add,this.permissionsRequired)):i.push(s(this.routesRequired.add))),this.routesRequired&&this.routesRequired.edit&&(typeof this.permissionsRequired=="object"&&this.permissionsRequired!==null&&this.permissionsRequired.edit?i.push(r(this.routesRequired.edit,this.permissionsRequired.edit)):this.permissionsRequired?i.push(r(this.routesRequired.edit,this.permissionsRequired)):i.push(r(this.routesRequired.edit))),this.routesRequired&&this.routesRequired.config&&(typeof this.permissionsRequired=="object"&&this.permissionsRequired!==null&&this.permissionsRequired.config?i.push(o(this.routesRequired.config,this.permissionsRequired.config)):this.permissionsRequired?i.push(o(this.routesRequired.config,this.permissionsRequired)):i.push(o(this.routesRequired.config))),this.headerButtons&&(i=i.concat(this.headerButtons));let t=[];return this.headerLinks&&(t=t.concat(this.headerLinks)),t.push(h()),t.push(d()),{hideLinks:this.hideHeaderLinks||!1,buttons:i,links:t,title:this.pageTitle||"",subTitle:this.pageTitle&&this.subTitle||""}},getKeyBindingOptions(){let i={...l};return this.routesRequired&&this.routesRequired.add&&(i.key_a=this.routesRequired.add),this.routesRequired&&this.routesRequired.edit&&(i.key_e=this.routesRequired.edit),i},applyPageHeader(){let i=Object.assign({},this.getHeaderOptions(),this.header||{}),t=Object.assign({},this.getKeyBindingOptions(),this.keyBindings||{});this.SetPageHeader(i),this.SetConfig({keyBindings:t}),this.updatePageTitle()},updatePageTitle(){if(!this.pageTitle||this.pageTitle.length<1)return;let i=window.kmenv.name;i=this.configs&&this.configs.basic&&this.configs.basic.appName?this.configs.basic.appName:i,document.title=this.pageTitle+" - "+i},async export(i){this.isLoading=!0;try{let t=`Printing ${this.dataTitle||""}`;this.printTitle&&(t=this.printTitle);const e=this.configs.system.printPreview;this.$printComponent("printable",{title:t,autoPrint:!e,autoCloseAfterPrint:!e})}catch{}this.isLoading=!1},doInit(){this.Init({url:this.initUrl}),this.initSubUrl&&this.InitSub({url:(this.subUuid?this.subUuid+"/":"")+this.initSubUrl}),this.getInitialData(this.applyPageHeader)},getBalanceClass(i){let t=i>0?"text-success":"text-danger";return t=i&&Number(i)!=0?t:"",t=t+" font-weight-600",t},momentFn(i,t,e){return moment(i,t||this.vars.serverDateFormat).format(e||this.vars.defaultDateFormat)}},mounted(){a.$off("EXPORT",this.export),a.$on("EXPORT",this.export),this.$route.params.uuid&&(this.uuid=this.$route.params.uuid),this.$route.params.subUuid&&(this.subUuid=this.$route.params.subUuid),this.configs.system&&this.configs.system.allowedFileExtensions&&(this.uploaderConfig.allowedExtensions=this.configs.system.allowedFileExtensions),this.configs.system&&this.configs.system.postMaxSize&&(this.uploaderConfig.allowedMaxFileSize=this.configs.system.postMaxSize),this.$route.query&&this.$route.query.hasOwnProperty("print")&&(this.autoExport=!0),this.doInit()},beforeDestroy(){delete this.formData,delete this.formErrors,delete this.preRequisite},destroyed(){a.$off("EXPORT",this.export)},beforeRouteEnter(i,t,e){i.params.uuid?e():e({name:t})}};export{q as v};
