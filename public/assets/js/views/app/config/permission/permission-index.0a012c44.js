import{j as r}from"../../../../app.a373aa59.js";import{m as l}from"../../../../vendor/vendor-core.3574f8d9.js";import{n as u}from"../../../../_plugin-vue2_normalizer.7b9a2fe2.js";import"../../../../vendor/vendor-others.c8ba1624.js";import"../../../../vendor/vendor-essential.91b5cfa2.js";import"../../../../vendor/vendor-bootstrap-vue.17129278.js";import"../../../../vendor/vendor-vue-gtag.f8884558.js";const o="/config/permissions";function m(e){return r({url:o+"/pre-requisite",method:"get",params:{module:e}})}function d(e){return r({url:o+"/assign",method:"post",data:e})}const c={data(){return{activeModule:"config",formData:{roles:[]},preRequisite:{roles:[],permissions:[],modules:[],assignedPermissions:[]},formErrors:{},initialFormData:null,isLoading:!1}},computed:{...l("config",["vars"])},methods:{submit(){this.isLoading=!0,d({...this.formData,module:this.activeModule}).then(e=>{this.isLoading=!1,this.$toasted.success(e.message,this.$toastConfig.success)}).catch(e=>{this.isLoading=!1,this.formErrors=formUtil.handleErrors(e)})},getInitialData(){this.isLoading=!0,this.$route.query&&this.$route.query.module&&(this.activeModule=this.$route.query.module),m(this.activeModule).then(e=>{this.preRequisite=_.cloneDeep(e),this.formData.roles=[],this.preRequisite.roles.forEach(t=>{let s=this.preRequisite.assignedPermissions.find(i=>i.role.toUpperCase()===t.name.toUpperCase());this.formData.roles.push({name:t.name,permissions:s!="undefined"?s.permissions:[]})}),this.isLoading=!1}).catch(e=>{this.isLoading=!1,this.formErrors=formUtil.handleErrors(e)})},humanize(e){return _.startCase(e)},updateRouteQuery(e){const t=Object.assign({},this.$route.query,e);this.$router.push({path:this.$route.path,query:t})}},mounted(){this.getInitialData()},watch:{$route(){this.getInitialData()}}};var p=function(){var t=this,s=t._self._c;return s("base-container",{staticClass:"p-0 flex-grow",attrs:{boxed:"","with-loader":"","is-loading":t.isLoading,"loader-color":t.vars.loaderColor}},[s("div",{staticClass:"text-right p-4"},[s("base-dropdown",{attrs:{tag:"div",direction:"down","menu-classes":"show-dropdown-up",position:"right"}},[s("base-button",{attrs:{slot:"title",type:"button","data-toggle":"dropdown",role:"button",design:"info",size:"md"},slot:"title"},[s("i",{staticClass:"fas fa-boxes"}),t._v(" "+t._s(t.$t(t.activeModule+"."+t.activeModule))+" "),s("i",{staticClass:"fas fa-chevron-down"})]),t._l(t.preRequisite.modules,function(i){return s("a",{staticClass:"dropdown-item",on:{click:function(a){return t.updateRouteQuery({module:i})}}},[t._v(" "+t._s(t.$t(i+"."+i))+" "),i==t.activeModule?s("i",{staticClass:"fas fa-check pull-right"}):t._e()])})],2)],1),s("div",{staticClass:"table-responsive table-wrapper"},[s("form",{on:{submit:function(i){return i.preventDefault(),t.submit.apply(null,arguments)}}},[s("table",{staticClass:"table b-table table-striped table-hover b-table-stacked-sm"},[s("thead",[s("tr",[s("th",[t._v(t._s(t.$t("config.permission.permissions")))]),t._l(t.formData.roles,function(i){return s("th",[t._v(t._s(t.humanize(i.name)))])})],2)]),s("tbody",t._l(t.preRequisite.permissions,function(i){return s("tr",[s("td",[t._v(t._s(t.humanize(i)))]),t._l(t.formData.roles,function(a){return s("td",[s("base-checkbox",{staticClass:"ml-3",attrs:{value:i,disabled:a.name==="admin"},model:{value:a.permissions,callback:function(n){t.$set(a,"permissions",n)},expression:"rolePermission.permissions"}})],1)})],2)}),0)]),s("div",{staticClass:"text-right mt-5 px-4 mb-4"},[s("base-button",{attrs:{type:"submit",design:"primary"}},[t._v(t._s(t.$t("global.save",{attribute:t.$t("config.permission.permissions")})))])],1)])])])},h=[],f=u(c,p,h,!1,null,null,null,null);const x=f.exports;export{x as default};
