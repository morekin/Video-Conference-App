import{m as l,i as n}from"../../../vendor/vendor-core.3574f8d9.js";import{E as r}from"../../../event-bus.6a5776a8.js";import{F as m}from"../../../FileUploader.78ddb8c0.js";import{n as u}from"../../../_plugin-vue2_normalizer.7b9a2fe2.js";import"../../../vendor/vendor-others.c8ba1624.js";import"../../../uploader.da0c2632.js";import"../../../app.a373aa59.js";import"../../../vendor/vendor-essential.91b5cfa2.js";import"../../../vendor/vendor-bootstrap-vue.17129278.js";import"../../../vendor/vendor-vue-gtag.f8884558.js";const c={components:{FileUploader:m},data(){return{formData:{uuid:null,columns:[],updated:!1,uploaded:!1},formErrors:{},preRequisite:{items:[],options:[]},uploaderConfig:{allowedExtensions:["csv"],maxNoOfFiles:1},initialFormData:null,isLoading:!1}},computed:{...l("config",["vars"])},methods:{...n("common",["Store","Init"]),submit(){if(formUtil.isUnchanged(this.initialFormData,this.formData))return this.$toasted.info(this.$t("general.nothing_changed"),this.$toastConfig.info),!1;formUtil.confirmAction().then(e=>{e.value&&(this.isLoading=!0,this.Store(this.formData).then(t=>{this.$toasted.success(t.message,this.$toastConfig),this.clear(),this.isLoading=!1}).catch(t=>{this.isLoading=!1,this.formErrors=formUtil.handleErrors(t)}))})},unsavedCheck(e){formUtil.unsavedCheckAlert(this.initialFormData,this.formData,e)},clear(){this.formData.uuid=null,this.preRequisite.items=[],this.preRequisite.options=[],this.formData.columns=[],this.formData.uploaded=!1,this.formData.updated=!1},handleFileUpload(e){if(e.uuid){this.formData.uuid=e.uuid,this.preRequisite.items=e.items,this.preRequisite.options=e.options;const t=e.items[0],s=Array.from(Object.keys(t),o=>t[o]);this.formData.columns=s.map((o,a)=>({selected:e.options[a]})),this.formData.uploaded=!0,this.formData.updated=!0}}},mounted(){r.$off("ROUTE_LEAVING",this.unsavedCheck),r.$on("ROUTE_LEAVING",this.unsavedCheck),this.Init({url:"contacts/import/finish"})},destroyed(){r.$off("ROUTE_LEAVING",this.unsavedCheck)},beforeRouteLeave(e,t,s){r.$emit("ROUTE_LEAVING",s)}};var d=function(){var t=this,s=t._self._c;return s("base-container",{attrs:{boxed:"","with-loader":"","is-loading":t.isLoading,"loader-color":t.vars.loaderColor}},[s("form",{on:{submit:function(o){return o.preventDefault(),t.submit.apply(null,arguments)}}},[t.formData.uploaded?s("div",{staticClass:"mt-3"},[s("h5",{staticClass:"pb-4"},[t._v(t._s(t.$t("general.choose_columns")))]),s("div",{staticClass:"row"},t._l(t.formData.columns,function(o,a){return s("div",{staticClass:"col-12 col-md-3 mb-5"},[s("base-select",{attrs:{options:t.preRequisite.options,label:t.$t("general.column",{number:a+1}),error:t.formErrors["column"+a],"allow-empty":!1,disabled:t.isLoading},on:{"update:error":function(i){return t.$set(t.formErrors,"column"+a,i)}},model:{value:o.selected,callback:function(i){t.$set(o,"selected",i)},expression:"column.selected"}}),s("h6",{staticClass:"small text-muted px-2 font-weight-bold"},[t._v(" "+t._s(t.$t("general.sample"))+": "),s("span",{staticClass:"text-muted px-2 comma-list"},[t._l(t.preRequisite.items,function(i){return[i[a]?s("span",[t._v(t._s(i[a]))]):t._e()]})],2)])],1)}),0),s("div",{staticClass:"form-footer"},[s("div",{staticClass:"right-side"},[s("base-button",{attrs:{type:"submit",design:"primary"}},[t._v(t._s(t.$t("global.import",{attribute:t.$t("contact.contacts")})))])],1)])]):s("div",{staticClass:"py-5"},[s("file-uploader",{attrs:{"name-label":"upload.file",options:t.uploaderConfig,multiple:!1,url:"/contacts/import/start","button-classes":"justify-content-center"},on:{updated:t.handleFileUpload}})],1)])])},f=[],p=u(c,d,f,!1,null,null,null,null);const U=p.exports;export{U as default};
