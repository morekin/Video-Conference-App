import{P as n,a as l}from"../../../../ProfilePage.f2eb4651.js";import"../../../../app.a373aa59.js";import{m as s,i as o}from"../../../../vendor/vendor-core.3574f8d9.js";import{E as i}from"../../../../event-bus.6a5776a8.js";import{n as m}from"../../../../_plugin-vue2_normalizer.7b9a2fe2.js";import"../../../../vendor/vendor-others.c8ba1624.js";import"../../../../vendor/vendor-essential.91b5cfa2.js";import"../../../../vendor/vendor-bootstrap-vue.17129278.js";import"../../../../vendor/vendor-vue-gtag.f8884558.js";const u={components:{ProfilePage:n,ProfilePageSidebox:l},data(){return{entity:null,isLoading:!1,initUrl:"users",dataTitle:$t("user.user"),fallBackRoute:"appUserList",formData:{name:"",mobile:"",gender:null,birthDate:null},formErrors:{},formLabels:{name:$t("user.props.name"),mobile:$t("user.props.mobile"),gender:$t("user.props.gender"),birthDate:$t("user.props.birth_date")},initianLength:0,initialFormData:null,emptyFormData:null,preRequisite:{genders:[]}}},computed:{...s("config",["vars"]),...s("user",["uuid","liveUsers"]),liveUser(){return this.value&&this.liveUsers.find(r=>r.uuid===this.value.uuid)},isOnline(){return!!this.liveUser}},methods:{...o("common",["Init","Get","Custom","GetPreRequisite"]),...o("user",["GetUser"]),submit(){if(formUtil.isUnchanged(this.initialFormData,this.formData))return this.$toasted.info(this.$t("general.nothing_changed"),this.$toastConfig.info),!1;this.isLoading=!0,this.Custom({method:"post",url:"/profile",data:this.formData}).then(r=>{this.$toasted.success(r.message,this.$toastConfig),this.GetUser(),this.initialFormData=_.cloneDeep(this.formData),this.$router.back(),this.isLoading=!1}).catch(r=>{this.isLoading=!1,this.formErrors=formUtil.handleErrors(r)})},reset(){formUtil.confirmAction().then(r=>{r.value&&(this.formData=Object.assign({},this.formData,_.cloneDeep(this.initialFormData)))})},unsavedCheck(r){formUtil.unsavedCheckAlert(this.initialFormData,this.formData,r)},fillPreRequisite(r){this.preRequisite.objForEach((t,e)=>{this.preRequisite[e]=r.hasOwnProperty(e)?r[e]:t})},setEntityData(r){this.entity=r,this.formData.objForEach((t,e)=>{this.formData[e]=r.profile.hasOwnProperty(e)?r.profile[e]:r.hasOwnProperty(e)?r[e]:t})},async getInitialData(){this.isLoading=!0;try{const r=await this.Get({uuid:this.uuid});this.setEntityData(r);const t=await this.GetPreRequisite();return this.fillPreRequisite(t),this.isLoading=!1,r}catch(r){this.isLoading=!1,formUtil.handleErrors(r),this.$router.push({name:this.fallBackRoute})}},doInit(){this.Init({url:this.initUrl}),this.getInitialData()}},mounted(){i.$off("ROUTE_LEAVING",this.unsavedCheck),i.$on("ROUTE_LEAVING",this.unsavedCheck),this.doInit()},beforeDestroy(){delete this.formData,delete this.formErrors,delete this.formLabels,delete this.preRequisite,delete this.keepAddingFields},destroyed(){i.$off("ROUTE_LEAVING",this.unsavedCheck)}};var f=function(){var t=this,e=t._self._c;return e("profile-page",{attrs:{"is-loading":t.isLoading,"loader-color":t.vars.loaderColor},scopedSlots:t._u([{key:"sidebarMainContent",fn:function(){return[t.entity?e("profile-card",{attrs:{name:t.entity.profile.name,"sub-heading":t.entity.username||"-",gender:t.entity.profile.gender,image:t.entity.profile.avatar,age:t.entity.profile.age,"data-card-color":"whitish","user-status":t.isOnline,user:t.entity,horizontal:!1}}):t._e()]},proxy:!0},{key:"mainContent",fn:function(){return[e("base-container",{attrs:{boxed:"","with-loader":"","has-footer":"","min-height":"full","is-loading":t.isLoading,"loader-color":t.vars.loaderColor}},[e("form",{on:{submit:function(a){return a.preventDefault(),t.submit.apply(null,arguments)}}},[t.entity?[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-md-6 mb-3"},[e("base-input",{attrs:{"auto-focus":"",label:t.formLabels.name,type:"text",error:t.formErrors.name,required:"",format:"startCase"},on:{"update:error":function(a){return t.$set(t.formErrors,"name",a)}},model:{value:t.formData.name,callback:function(a){t.$set(t.formData,"name",a)},expression:"formData.name"}})],1),e("div",{staticClass:"col-12 col-md-6 mb-3"},[e("base-input",{attrs:{label:t.formLabels.mobile,type:"text",error:t.formErrors.mobile,required:""},on:{"update:error":function(a){return t.$set(t.formErrors,"mobile",a)}},model:{value:t.formData.mobile,callback:function(a){t.$set(t.formData,"mobile",a)},expression:"formData.mobile"}})],1),e("div",{staticClass:"col-12 col-md-6 mb-3"},[e("base-select",{attrs:{options:t.preRequisite.genders,label:t.formLabels.gender,error:t.formErrors.gender,required:""},on:{"update:error":function(a){return t.$set(t.formErrors,"gender",a)}},model:{value:t.formData.gender,callback:function(a){t.$set(t.formData,"gender",a)},expression:"formData.gender"}})],1),e("div",{staticClass:"col-12 col-md-6 mb-3"},[e("base-input",{attrs:{label:t.formLabels.birthDate,"addon-right-icon":"far fa-calendar-alt",type:"text",error:t.formErrors.birthDate,"is-wrapper":!0},on:{"update:error":function(a){return t.$set(t.formErrors,"birthDate",a)}},model:{value:t.formData.birthDate,callback:function(a){t.$set(t.formData,"birthDate",a)},expression:"formData.birthDate"}},[e("date-picker",{staticClass:"form-control datepicker",attrs:{config:t.vars.datepickerConfig},model:{value:t.formData.birthDate,callback:function(a){t.$set(t.formData,"birthDate",a)},expression:"formData.birthDate"}})],1)],1)])]:t._e(),e("div",{staticClass:"form-footer mt-5"},[e("div",{staticClass:"left-side"},[e("base-button",{attrs:{type:"button",design:"light",tabindex:"-1"},on:{click:function(a){return t.$router.back()}}},[e("i",{staticClass:"fas fa-chevron-left"}),t._v(" "+t._s(t.$t("general.back")))])],1),e("div",{staticClass:"right-side"},[e("base-button",{attrs:{type:"button",design:"light"},on:{click:t.reset}},[t._v(t._s(t.$t("general.reset")))]),e("base-button",{attrs:{type:"submit",design:"primary"}},[e("i",{staticClass:"fas fa-save"}),t._v(" "+t._s(t.$t("global.save",{attribute:t.$t("user.profile")})))])],1)])],2)])]},proxy:!0}])})},d=[],c=m(u,f,d,!1,null,null,null,null);const E=c.exports;export{E as default};
