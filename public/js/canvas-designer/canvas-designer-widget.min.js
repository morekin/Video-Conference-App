function CanvasDesigner(){var designer=this;designer.iframe=null;var tools={line:!0,arrow:!0,pencil:!0,dragSingle:!0,dragMultiple:!0,eraser:!0,rectangle:!0,arc:!0,bezier:!1,quadratic:!0,text:!0,image:!0,pdf:!0,marker:!0,zoom:!1,lineWidth:!0,colorsPicker:!0,extraOptions:!1,code:!1};designer.icons={line:null,arrow:null,pencil:null,dragSingle:null,dragMultiple:null,eraser:null,rectangle:null,arc:null,bezier:null,quadratic:null,text:null,image:null,pdf:null,pdf_next:null,pdf_prev:null,pdf_close:null,marker:null,zoom:null,lineWidth:null,colorsPicker:null,extraOptions:null,code:null};var selectedIcon="pencil";var syncDataListener=function(data){},dataURLListener=function(dataURL){},captureStreamCallback=function(){};function onMessage(event){if(event.data&&event.data.uid===designer.uid){if(!event.data.sdp)return event.data.canvasDesignerSyncData?(designer.pointsLength=event.data.canvasDesignerSyncData.points.length,void syncDataListener(event.data.canvasDesignerSyncData)):void(event.data.dataURL&&dataURLListener(event.data.dataURL));webrtcHandler.createAnswer(event.data,(function(response){response.sdp?designer.postMessage(response):captureStreamCallback(response.stream)}))}}designer.uid=function(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var a=window.crypto.getRandomValues(new Uint32Array(3)),token="",i=0,l=a.length;i<l;i++)token+=a[i].toString(36);return token}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}(),designer.appendTo=function(parentNode,callback){callback=callback||function(){},designer.iframe=document.createElement("iframe"),designer.iframe.onload=function(){callback(),callback=null},designer.iframe.src=designer.widgetHtmlURL+"?widgetJsURL="+designer.widgetJsURL+"&uid="+designer.uid+"&tools="+JSON.stringify(tools)+"&selectedIcon="+selectedIcon+"&icons="+JSON.stringify(designer.icons),designer.iframe.style.width="100%",designer.iframe.style.height="100%",designer.iframe.style.border=0,window.removeEventListener("message",onMessage),window.addEventListener("message",onMessage,!1),parentNode.appendChild(designer.iframe)},designer.destroy=function(){designer.iframe&&(designer.iframe.parentNode.removeChild(designer.iframe),designer.iframe=null),window.removeEventListener("message",onMessage)},designer.addSyncListener=function(callback){syncDataListener=callback},designer.syncData=function(data){designer.iframe&&designer.postMessage({canvasDesignerSyncData:data})},designer.setTools=function(_tools){tools=_tools},designer.setSelected=function(icon){void 0!==tools[icon]&&(selectedIcon=icon)},designer.toDataURL=function(format,callback){dataURLListener=callback,designer.iframe&&designer.postMessage({genDataURL:!0,format:format})},designer.sync=function(){designer.iframe&&designer.postMessage({syncPoints:!0})},designer.pointsLength=0,designer.undo=function(index){designer.iframe&&("string"==typeof index&&tools[index]?designer.postMessage({undo:!0,tool:index}):designer.postMessage({undo:!0,index:index||designer.pointsLength-1||-1}))},designer.postMessage=function(message){designer.iframe&&(message.uid=designer.uid,designer.iframe.contentWindow.postMessage(message,"*"))},designer.captureStream=function(callback){designer.iframe&&(captureStreamCallback=callback,designer.postMessage({captureStream:!0}))},designer.clearCanvas=function(){designer.iframe&&designer.postMessage({clearCanvas:!0})},designer.renderStream=function(){designer.iframe&&designer.postMessage({renderStream:!0})},designer.widgetHtmlURL="widget.html",designer.widgetJsURL="widget.js"}